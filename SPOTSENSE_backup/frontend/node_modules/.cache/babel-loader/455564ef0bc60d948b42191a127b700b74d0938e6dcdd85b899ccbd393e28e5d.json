{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import{useParams,useNavigate,useLocation}from'react-router-dom';import{MapIcon,ClockIcon,CurrencyRupeeIcon,ArrowPathIcon,MapPinIcon,VideoCameraIcon,EyeIcon,CheckCircleIcon,AdjustmentsHorizontalIcon,ShieldCheckIcon}from'@heroicons/react/24/outline';import{Card,Button,Input,Select,Badge,Loading,Alert,Modal}from'../components/common';import{toast}from'react-toastify';import{useAuth}from'../context/AuthContext';import{LoginModal,SignupModal}from'../components/auth';import html2canvas from'html2canvas';import jsPDF from'jspdf';import{format}from'date-fns';// Set the base URL for the Python backend API\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const API_BASE_URL='/api';// Use relative path for API requests\n// Add after the API_BASE_URL constant\nconst HOURLY_RATE=40;// ₹40 per hour\nconst REFRESH_INTERVAL=30000;// Increased to 30 seconds (from 10 seconds)\n// Duration options\nconst DURATION_OPTIONS=[{value:'1',label:'1 Hour',hours:1},{value:'2',label:'2 Hours',hours:2},{value:'3',label:'3 Hours',hours:3},{value:'4',label:'4 Hours',hours:4},{value:'24',label:'24 Hours (Full Day)',hours:24}];// Vehicle types\nconst VEHICLE_TYPES=[{value:'car',label:'Car'},{value:'bike',label:'Bike/Scooter'},{value:'suv',label:'SUV'},{value:'truck',label:'Truck/Van'}];// Payment methods\nconst PAYMENT_METHODS=[{value:'upi',label:'UPI'},{value:'card',label:'Credit/Debit Card'},{value:'cash',label:'Cash'}];// Add local video sources at the top of the file\nconst LOCAL_VIDEOS={main:'/videos/carPark.mp4',reverse:'/videos/carPark_Reverse.mp4'};const ParkingSlotPage=()=>{var _location$state,_VEHICLE_TYPES$find2,_DURATION_OPTIONS$fin,_PAYMENT_METHODS$find;const{parkingId}=useParams();const navigate=useNavigate();const location=useLocation();const{isAuthenticated,user}=useAuth();// Get parking details from location state if available\nconst passedParkingDetails=(_location$state=location.state)===null||_location$state===void 0?void 0:_location$state.parkingDetails;const[isLoading,setIsLoading]=useState(true);const[parkingDetails,setParkingDetails]=useState(null);const[parkingSlots,setParkingSlots]=useState([]);const[selectedSlot,setSelectedSlot]=useState(null);const[isBookingModalOpen,setIsBookingModalOpen]=useState(false);const[isLoginModalOpen,setIsLoginModalOpen]=useState(false);const[isSignupModalOpen,setIsSignupModalOpen]=useState(false);const[isAPIConnected,setIsAPIConnected]=useState(false);const[videoFeed,setVideoFeed]=useState(null);const[showVideo,setShowVideo]=useState(false);const[pauseRefresh,setPauseRefresh]=useState(false);const[lastRefreshTime,setLastRefreshTime]=useState(null);const[videoSource,setVideoSource]=useState('main');const[videoSources,setVideoSources]=useState([]);const[debugMode,setDebugMode]=useState(false);const[processingMode,setProcessingMode]=useState('full');const[viewMode,setViewMode]=useState('processed');// 'processed', 'raw', 'grayscale', 'threshold'\n// Booking form\nconst[bookingForm,setBookingForm]=useState({name:'',vehicleNumber:'',vehicleType:'car',mobileNumber:'',paymentMethod:'upi',duration:'1',totalAmount:HOURLY_RATE// Default to 1 hour rate\n});const[bookingComplete,setBookingComplete]=useState(false);const[bookingReference,setBookingReference]=useState(null);// Add card form state\nconst[cardForm,setCardForm]=useState({cardNumber:'',expiryDate:'',cvv:'',cardName:''});// Add ticket ref for PDF generation\nconst ticketRef=useRef(null);// Function to fetch video feed from the backend\nconst fetchVideoFeed=async()=>{try{// Make a fetch request to check if the video API is available\nconst response=await fetch(`${window.location.protocol}//${window.location.hostname}:5000/api/parking/video/status`,{method:'GET'});if(response.ok){const data=await response.json();setVideoSource(data.current_source);setDebugMode(data.debug_mode);setProcessingMode(data.processing_mode);console.log('Video status:',data);// Set the video feed URL directly to the streaming endpoint\nupdateVideoFeedUrl(data.current_source);// Also fetch available video sources\nfetchVideoSources();setIsAPIConnected(true);}else{throw new Error('Video API not available');}}catch(error){console.error('Error setting up video feed:',error);// If API fails, set to use local video files as fallback\nsetVideoFeed(LOCAL_VIDEOS[videoSource||'main']);setIsAPIConnected(false);toast.info(\"Using local video file as backend is not available\");}};const fetchVideoSources=async()=>{try{const response=await fetch(`${window.location.protocol}//${window.location.hostname}:5000/api/parking/video/sources`);if(response.ok){const data=await response.json();setVideoSources(data.available);setVideoSource(data.current);}}catch(error){console.error('Error fetching video sources:',error);}};const updateVideoFeedUrl=source=>{const baseUrl=`${window.location.protocol}//${window.location.hostname}:5000/api/parking`;// Set URL based on view mode\nlet url;switch(viewMode){case'raw':url=`${baseUrl}/video/raw`;break;case'grayscale':url=`${baseUrl}/video/grayscale`;break;case'threshold':url=`${baseUrl}/video/threshold`;break;case'processed':default:url=`${baseUrl}/video`;}setVideoFeed(url);console.log('Video feed URL set to:',url);};const changeVideoSource=async source=>{try{if(isAPIConnected){const response=await fetch(`${window.location.protocol}//${window.location.hostname}:5000/api/parking/video/select`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({source})});if(response.ok){const data=await response.json();setVideoSource(data.current_source);toast.success(`Video source changed to ${source}`);// Refresh the feed URL\nupdateVideoFeedUrl(source);}else{throw new Error('Failed to change video source');}}else{// Use local video sources when API is not connected\nsetVideoSource(source);setVideoFeed(LOCAL_VIDEOS[source]);toast.info(`Video source changed to ${source} (local file)`);}}catch(error){console.error('Error changing video source:',error);// Fallback to local videos\nsetVideoSource(source);setVideoFeed(LOCAL_VIDEOS[source]);toast.info(`Video source changed to ${source} (local file)`);}};const toggleDebugMode=async()=>{try{const newDebugMode=!debugMode;const response=await fetch(`${window.location.protocol}//${window.location.hostname}:5000/api/parking/video/debug`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({enabled:newDebugMode})});if(response.ok){setDebugMode(newDebugMode);toast.success(`Debug mode ${newDebugMode?'enabled':'disabled'}`);}else{throw new Error('Failed to toggle debug mode');}}catch(error){console.error('Error toggling debug mode:',error);toast.error('Failed to toggle debug mode');}};const setVideoProcessingMode=async mode=>{try{const response=await fetch(`${window.location.protocol}//${window.location.hostname}:5000/api/parking/video/mode`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({mode})});if(response.ok){setProcessingMode(mode);toast.success(`Processing mode set to ${mode}`);}else{throw new Error('Failed to change processing mode');}}catch(error){console.error('Error changing processing mode:',error);toast.error('Failed to change processing mode');}};const changeViewMode=mode=>{setViewMode(mode);updateVideoFeedUrl(videoSource);toast.info(`View changed to ${mode}`);};// Use the generateSlotsData function to generate slot data without updating state\nconst generateSlotsData=(total,available)=>{const slots=[];const availableSlots=[];// Generate random available slots\nwhile(availableSlots.length<available){const randomSlot=Math.floor(Math.random()*total)+1;if(!availableSlots.includes(randomSlot)){availableSlots.push(randomSlot);}}// Create the slots array with status\nfor(let i=1;i<=total;i++){slots.push({id:i,number:i,status:availableSlots.includes(i)?'available':'occupied',type:i%5===0?'handicapped':i%7===0?'electric':'standard'});}return slots;};// Remove the old duplicate generateParkingSlots function and update this one\nconst generateParkingSlots=(total,available)=>{const slots=generateSlotsData(total,available);setParkingSlots(slots);return slots;};useEffect(()=>{// Check if we have parking details passed from the previous page\nif(passedParkingDetails){// Use the passed parking details\nsetParkingDetails({id:passedParkingDetails.id,name:passedParkingDetails.name,address:passedParkingDetails.address,coordinates:passedParkingDetails.coordinates,hours:passedParkingDetails.hours,operatingTime:passedParkingDetails.hours,rates:{hourly:passedParkingDetails.hourlyRate,daily:`₹${parseInt(passedParkingDetails.hourlyRate.replace('₹','').replace('/hr',''))*5}/day`},features:passedParkingDetails.features?passedParkingDetails.features.split(', '):[],totalSlots:69,// Always set to 69 total spots\navailableSlots:passedParkingDetails.available,type:passedParkingDetails.type});// Generate parking slots based on the passed details\ngenerateParkingSlots(69,passedParkingDetails.available);setIsLoading(false);}else{// Fallback to fetching parking details\nfetchParkingDetails();}// Attempt to load the video feed\nfetchVideoFeed();// Set up interval to periodically refresh data with longer interval\nconst intervalId=setInterval(()=>{// Only refresh if not paused (user is not in booking process)\nif(!pauseRefresh&&!passedParkingDetails){fetchLiveData();setLastRefreshTime(new Date().toLocaleTimeString());}},REFRESH_INTERVAL);// Clean up interval on unmount\nreturn()=>clearInterval(intervalId);},[parkingId,passedParkingDetails,pauseRefresh]);// Effect to update video feed URL when view mode changes\nuseEffect(()=>{if(videoFeed){updateVideoFeedUrl(videoSource);}},[viewMode]);// Effect to pause refresh when booking modal is open\nuseEffect(()=>{setPauseRefresh(isBookingModalOpen);},[isBookingModalOpen]);// Add keyboard event listener for debug mode\nuseEffect(()=>{const handleKeyDown=e=>{// Only respond to keyboard events when video is showing\nif(!showVideo)return;// 'D' key toggles debug mode\nif(e.key.toLowerCase()==='d'){toggleDebugMode();}};window.addEventListener('keydown',handleKeyDown);// Clean up\nreturn()=>{window.removeEventListener('keydown',handleKeyDown);};},[showVideo,debugMode]);// Update slots when live data comes in\nconst updateSlots=newSlots=>{setParkingSlots(prevSlots=>{return prevSlots.map(slot=>{const updatedSlot=newSlots.find(s=>s.id===slot.id);return updatedSlot||slot;});});};const handleSlotSelect=slot=>{// Don't select occupied slots\nif(slot.status==='occupied')return;// Toggle selection\nif(selectedSlot&&selectedSlot.id===slot.id){setSelectedSlot(null);}else{setSelectedSlot(slot);}};const fetchLiveData=async()=>{// Don't fetch if booking modal is open\nif(isBookingModalOpen)return;try{// Try to connect to the Python backend API for real-time video processing\nconst response=await fetch(`${API_BASE_URL}/parking/spaces${parkingDetails!==null&&parkingDetails!==void 0&&parkingDetails.id?`?parkingId=${parkingDetails.id}`:''}`);if(!response.ok){throw new Error(`HTTP error! Status: ${response.status}`);}const data=await response.json();if(data){setIsAPIConnected(true);console.log('Raw API response:',data);// Log the raw response for debugging\n// Update available spots count based on real data\nif(parkingDetails){setParkingDetails(prev=>({...prev,availableSlots:data.available,totalSlots:data.total||69// Use total from API if available\n}));}// Transform API data to match our slot format\nif(data.spaces&&Object.keys(data.spaces).length>0){// If real spaces data is provided, convert from object to array\nconst apiSlots=Object.entries(data.spaces).map(_ref=>{let[id,space]=_ref;return{id:parseInt(id),number:parseInt(id)+1,// Slot numbers start from 1\nstatus:space.status==='available'?'available':'occupied',type:parseInt(id)%5===0?'premium':'standard'};});console.log('Transformed API slots:',apiSlots);// Log for debugging\nupdateSlots(apiSlots);}else{// If only count is provided, create slots with random occupied/available\nconsole.log('Using counts to generate random slots: total=',data.total,'available=',data.available);const newSlots=generateSlotsData(data.total||69,data.available);updateSlots(newSlots);}setIsLoading(false);}}catch(error){console.error('Error fetching live parking data from video system:',error);// If API call fails, use mock data as fallback\nif(!isAPIConnected){console.log('Falling back to mock data');const mockSlots=Array.from({length:69},(_,index)=>{// Use a deterministic pattern for occupied slots\nconst isOccupied=[3,7,10,14,19,20,22,25,31,33,39,42,44,47,50,52,56,58,60,63,67].includes(index);return{id:index,number:index+1,status:isOccupied?'occupied':'available',type:index%5===0?'premium':'standard'};});updateSlots(mockSlots);// Update parking details to show correct number of available spots\nif(parkingDetails){const availableSpots=mockSlots.filter(slot=>slot.status==='available').length;setParkingDetails(prev=>({...prev,availableSlots:availableSpots,totalSlots:69// Always 69 total\n}));}setIsLoading(false);}}};const fetchParkingDetails=()=>{// Fetch parking details from an API\nsetIsLoading(true);fetch(`${API_BASE_URL}/parking/details/${parkingId}`).then(response=>{// If the API endpoint doesn't exist yet, we'll proceed with mock data\nif(!response.ok){// Create mock data\nconst mockParkingDetails={id:parkingId,name:'Central Mall Parking',address:'123 Main Street, City Center',totalSlots:40,availableSlots:15,rates:{hourly:'₹50/hour',daily:'₹400/day'},operatingHours:'6:00 AM - 10:00 PM'};return mockParkingDetails;}return response.json();}).then(data=>{setParkingDetails(data);// Generate parking slots based on the data\ngenerateParkingSlots(data.totalSlots,data.availableSlots);setIsLoading(false);}).catch(error=>{console.error('Error fetching parking details:',error);// Fallback to mock data on error\nconst mockParkingDetails={id:parkingId,name:'Central Mall Parking',address:'123 Main Street, City Center',totalSlots:40,availableSlots:15,rates:{hourly:'₹50/hour',daily:'₹400/day'},operatingHours:'6:00 AM - 10:00 PM'};setParkingDetails(mockParkingDetails);generateParkingSlots(mockParkingDetails.totalSlots,mockParkingDetails.availableSlots);setIsLoading(false);});};const handleInputChange=e=>{const{name,value}=e.target;setBookingForm(prev=>({...prev,[name]:value}));// Calculate price when duration changes\nif(name==='duration'){const price=calculatePrice(value);setBookingForm(prev=>({...prev,totalAmount:price}));}};const handleBookClick=()=>{// Check if user is authenticated\nif(!isAuthenticated()){toast.warning(\"Please login to book a parking slot\");setIsLoginModalOpen(true);return;}// Proceed with booking if authenticated\nsetIsBookingModalOpen(true);};const handleGetDirections=()=>{// Try to get user's current location for better directions\nif(navigator.geolocation){navigator.geolocation.getCurrentPosition(position=>{const origin=`${position.coords.latitude},${position.coords.longitude}`;const destination=`${parkingDetails.coordinates[0]},${parkingDetails.coordinates[1]}`;// Open Google Maps with directions from current location to parking\nwindow.open(`https://www.google.com/maps/dir/?api=1&origin=${origin}&destination=${destination}`,'_blank');toast.success(\"Directions loaded with your current location\");},error=>{console.error(\"Error getting user location:\",error);// Fallback to just opening the destination\nwindow.open(`https://www.google.com/maps/dir/?api=1&destination=${parkingDetails.coordinates[0]},${parkingDetails.coordinates[1]}`,'_blank');toast.info(\"Using default directions without your current location\");},{enableHighAccuracy:true,timeout:5000,maximumAge:0});}else{// Browser doesn't support geolocation\nwindow.open(`https://www.google.com/maps/search/?api=1&query=${parkingDetails.coordinates[0]},${parkingDetails.coordinates[1]}`,'_blank');toast.warning(\"Your browser doesn't support geolocation\");}};const downloadTicket=()=>{toast.info(\"Generating your PDF ticket...\");// Wait for the next render cycle to ensure the ticket content is fully rendered\nsetTimeout(()=>{const ticketElement=ticketRef.current;if(!ticketElement){toast.error(\"Could not generate ticket\");return;}// Use html2canvas to capture the ticket as an image\nhtml2canvas(ticketElement,{scale:2,// Higher scale for better quality\nuseCORS:true,logging:false,backgroundColor:'#ffffff'}).then(canvas=>{try{var _VEHICLE_TYPES$find;// Create a new PDF document\nconst pdf=new jsPDF({orientation:'portrait',unit:'mm',format:'a4'});// Get image from canvas and add to PDF\nconst imgData=canvas.toDataURL('image/png');const imgWidth=190;// Width in mm (A4 is 210mm wide, leaving margin)\nconst imgHeight=canvas.height*imgWidth/canvas.width;// Add company logo/header\npdf.setFillColor(255,204,0);// Yellow header\npdf.rect(0,0,210,20,'F');pdf.setTextColor(0,0,0);pdf.setFont('helvetica','bold');pdf.setFontSize(16);pdf.text('SpotSense - Smart Parking',105,12,{align:'center'});// Add image of the ticket\npdf.addImage(imgData,'PNG',10,30,imgWidth,imgHeight);// Add customer details\npdf.setFontSize(12);pdf.setFont('helvetica','normal');pdf.text(`Name: ${bookingForm.name}`,20,imgHeight+40);pdf.text(`Vehicle: ${bookingForm.vehicleNumber} (${(_VEHICLE_TYPES$find=VEHICLE_TYPES.find(v=>v.value===bookingForm.vehicleType))===null||_VEHICLE_TYPES$find===void 0?void 0:_VEHICLE_TYPES$find.label})`,20,imgHeight+48);pdf.text(`Mobile: ${bookingForm.mobileNumber}`,20,imgHeight+56);pdf.text(`Duration: ${bookingForm.duration} ${parseInt(bookingForm.duration)===1?'hour':'hours'}`,20,imgHeight+64);pdf.text(`Amount Paid: ₹${calculatePrice(bookingForm.duration)}`,20,imgHeight+72);// Add footer\npdf.setDrawColor(200,200,200);pdf.line(10,280,200,280);pdf.setFontSize(10);pdf.setTextColor(100,100,100);pdf.text('Thank you for using SpotSense. Drive safely!',105,288,{align:'center'});// Save PDF\npdf.save(`SpotSense_Parking_Ticket_${bookingReference}.pdf`);toast.success(\"Ticket downloaded successfully!\");}catch(error){console.error(\"Error generating PDF: \",error);toast.error(\"Error generating PDF ticket. Please try again.\");}}).catch(error=>{console.error(\"Error capturing ticket: \",error);toast.error(\"Error generating ticket. Please try again.\");});},500);};const validateForm=()=>{const{name,vehicleNumber,mobileNumber}=bookingForm;if(!name.trim()){toast.error(\"Please enter your name\");return false;}if(!vehicleNumber.trim()){toast.error(\"Please enter your vehicle number\");return false;}// Validate mobile number (exactly 10 digits)\nif(!/^\\d{10}$/.test(mobileNumber.trim())){toast.error(\"Please enter a valid 10-digit mobile number\");return false;}return true;};const handleBooking=()=>{if(!validateForm()){return;}setIsLoading(true);// Create booking data\nconst bookingData={parkingId:parkingDetails===null||parkingDetails===void 0?void 0:parkingDetails.id,slotId:selectedSlot===null||selectedSlot===void 0?void 0:selectedSlot.id,slotNumber:selectedSlot===null||selectedSlot===void 0?void 0:selectedSlot.number,name:bookingForm.name,vehicleNumber:bookingForm.vehicleNumber,vehicleType:bookingForm.vehicleType,mobileNumber:bookingForm.mobileNumber,duration:bookingForm.duration,totalAmount:calculatePrice(bookingForm.duration)};// Use fetch to simulate API call to book parking\n// In a real app, you would make an actual API call to your backend\nfetch(`${API_BASE_URL}/parking/book`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(bookingData)}).then(response=>{// If the API doesn't exist yet, we'll proceed with mock data\n// In a real app, you would only proceed if response.ok is true\nreturn response.ok?response.json():{success:true,reference:`BK${Math.floor(Math.random()*900000)+100000}`};}).then(data=>{// Set the booking reference from the response or use the mock one\nsetBookingReference(data.reference);setBookingComplete(true);setIsLoading(false);// Display success toast\ntoast.success(\"Booking successful!\",{position:\"bottom-right\",autoClose:3000,hideProgressBar:false,closeOnClick:true,pauseOnHover:true,draggable:true,style:{backgroundColor:\"#ffffff\",color:\"#333333\"}});// Update the parking slot status to booked\nif(selectedSlot){const updatedSlots=parkingSlots.map(slot=>{if(slot.id===selectedSlot.id){return{...slot,status:'occupied'};}return slot;});setParkingSlots(updatedSlots);// Update available count\nif(parkingDetails){setParkingDetails(prev=>({...prev,availableSlots:prev.availableSlots-1}));}}}).catch(error=>{console.error('Error booking parking spot:',error);toast.error('Failed to book parking spot. Please try again.');setIsLoading(false);});};// Add to renderContent\nconst refreshParkingData=()=>{setIsLoading(true);// Reset API connection status to force a fresh attempt\nsetIsAPIConnected(false);// Use the actual API endpoint\nfetch(`${API_BASE_URL}/parking/status`).then(response=>{if(!response.ok){throw new Error(`HTTP error! Status: ${response.status}`);}// If successful, fetch the full data\nfetchLiveData();setLastRefreshTime(new Date().toLocaleTimeString());toast.success(\"Parking data refreshed successfully!\");}).catch(error=>{console.error('Error refreshing parking data:',error);// Try the spaces endpoint directly as backup\nfetchLiveData();setLastRefreshTime(new Date().toLocaleTimeString());toast.info(\"Using latest available parking data\");});};const toggleVideoFeed=()=>{setShowVideo(!showVideo);};// Calculate price based on duration\nconst calculatePrice=hours=>{return HOURLY_RATE*parseInt(hours);};// Close button handler for booking confirmation modal\nconst handleCloseConfirmation=()=>{setIsBookingModalOpen(false);setBookingComplete(false);setSelectedSlot(null);setPauseRefresh(false);// Resume auto-refresh\nfetchLiveData();};// Add handler for card form changes\nconst handleCardInputChange=e=>{const{name,value}=e.target;setCardForm(prev=>({...prev,[name]:value}));};// Add function to handle signup click\nconst handleSignupClick=()=>{setIsLoginModalOpen(false);setIsSignupModalOpen(true);};// Add function to handle login click\nconst handleLoginClick=()=>{setIsSignupModalOpen(false);setIsLoginModalOpen(true);};// Add this useEffect to watch for authentication changes\nuseEffect(()=>{// If a slot is selected and user just logged in, show booking modal\nif(selectedSlot&&isAuthenticated()&&isLoginModalOpen){setIsLoginModalOpen(false);setIsBookingModalOpen(true);toast.success(\"Login successful! You can now book your selected slot.\");}},[isAuthenticated,selectedSlot,isLoginModalOpen]);if(isLoading&&!parkingDetails){return/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col items-center justify-center h-[70vh]\",children:[/*#__PURE__*/_jsx(Loading,{size:\"lg\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-4 text-neutral-600 dark:text-neutral-400\",children:\"Loading parking details...\"})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-4xl mx-auto\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-yellow-400 rounded-lg p-6 mb-6\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-center\",children:\"SpotSense\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-center text-black mt-1 text-sm\",children:\"Select and book your exact parking spot\"}),isAPIConnected&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center mt-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"inline-block h-2 w-2 rounded-full bg-green-500 mr-2\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs text-black\",children:\"Live data connected\"}),lastRefreshTime&&/*#__PURE__*/_jsxs(\"span\",{className:\"text-xs text-black ml-4\",children:[\"Last updated: \",lastRefreshTime]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end mb-4 space-x-2\",children:[/*#__PURE__*/_jsx(Button,{variant:\"outline\",size:\"sm\",leftIcon:/*#__PURE__*/_jsx(VideoCameraIcon,{className:\"h-4 w-4\"}),onClick:toggleVideoFeed,className:\"border-yellow-500 text-yellow-600\",children:showVideo?\"Hide Video Feed\":\"Show Video Feed\"}),isAPIConnected&&showVideo&&/*#__PURE__*/_jsx(Button,{variant:\"outline\",size:\"sm\",leftIcon:/*#__PURE__*/_jsx(AdjustmentsHorizontalIcon,{className:\"h-4 w-4\"}),onClick:toggleDebugMode,className:debugMode?\"border-green-500 text-green-600\":\"border-gray-500 text-gray-600\",children:debugMode?\"Disable Debug View\":\"Enable Debug View\"})]}),showVideo&&/*#__PURE__*/_jsxs(Card,{title:\"\",subtitle:\"\",footer:\"\",image:\"\",onClick:()=>{},className:\"mb-6 overflow-hidden\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relative pt-[56.25%]\",children:[\" \",isAPIConnected?/*#__PURE__*/// Use img tag for real-time MJPEG stream from backend\n_jsx(\"img\",{className:\"absolute top-0 left-0 w-full h-full object-cover\",src:videoFeed||`${window.location.protocol}//${window.location.hostname}:5000/api/parking/video`,alt:\"Live parking feed\"}):/*#__PURE__*/// Fallback to local video tag when API is not available\n_jsx(\"video\",{className:\"absolute top-0 left-0 w-full h-full object-cover\",src:videoFeed||LOCAL_VIDEOS.main,autoPlay:true,muted:true,loop:true,controls:true}),/*#__PURE__*/_jsxs(\"div\",{className:\"absolute top-2 right-2 bg-black/50 text-white text-xs px-2 py-1 rounded-full flex items-center\",children:[/*#__PURE__*/_jsx(EyeIcon,{className:\"h-3 w-3 mr-1\"}),/*#__PURE__*/_jsx(\"span\",{children:isAPIConnected?\"Live Feed\":\"Local Video\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"absolute bottom-0 left-0 right-0 bg-black/50 text-white text-xs p-2\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap justify-between items-center\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2 mb-1\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Source:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"flex space-x-1\",children:videoSources.length>0?videoSources.map(source=>/*#__PURE__*/_jsx(\"button\",{onClick:()=>changeVideoSource(source.id),className:`px-2 py-1 rounded text-xs ${videoSource===source.id?'bg-yellow-500 text-black':'bg-gray-700'}`,children:source.name},source.id)):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>changeVideoSource('main'),className:`px-2 py-1 rounded text-xs ${videoSource==='main'?'bg-yellow-500 text-black':'bg-gray-700'}`,children:\"Main Parking\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>changeVideoSource('reverse'),className:`px-2 py-1 rounded text-xs ${videoSource==='reverse'?'bg-yellow-500 text-black':'bg-gray-700'}`,children:\"Reverse Angle\"})]})})]}),isAPIConnected&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2 mb-1\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"View:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-1\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>changeViewMode('processed'),className:`px-2 py-1 rounded text-xs ${viewMode==='processed'?'bg-yellow-500 text-black':'bg-gray-700'}`,children:\"Processed\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>changeViewMode('raw'),className:`px-2 py-1 rounded text-xs ${viewMode==='raw'?'bg-yellow-500 text-black':'bg-gray-700'}`,children:\"Raw\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>changeViewMode('grayscale'),className:`px-2 py-1 rounded text-xs ${viewMode==='grayscale'?'bg-yellow-500 text-black':'bg-gray-700'}`,children:\"Grayscale\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>changeViewMode('threshold'),className:`px-2 py-1 rounded text-xs ${viewMode==='threshold'?'bg-yellow-500 text-black':'bg-gray-700'}`,children:\"Threshold\"})]})]})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-3 bg-gray-100 text-gray-800 text-sm\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:isAPIConnected?\"Live Video Feed\":\"Local Video Playback\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs mt-1\",children:isAPIConnected?/*#__PURE__*/_jsxs(_Fragment,{children:[\"\\u2022 Click on parking spaces in the video to select or deselect them (pink box)\",/*#__PURE__*/_jsx(\"br\",{}),\"\\u2022 Press 'D' key while viewing to show all processing steps (original, grayscale, threshold, dilated)\",/*#__PURE__*/_jsx(\"br\",{}),\"\\u2022 Change video source or view type using the controls above\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[\"\\u2022 Using local video files as the backend is not connected\",/*#__PURE__*/_jsx(\"br\",{}),\"\\u2022 Switch between Main and Reverse angle views using the controls above\",/*#__PURE__*/_jsx(\"br\",{}),\"\\u2022 Start the backend server to enable live processing\"]})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center mb-4\",children:[/*#__PURE__*/_jsx(Button,{variant:\"outline\",size:\"sm\",onClick:()=>navigate('/'),className:\"mr-4\",children:\"Back to List\"}),/*#__PURE__*/_jsx(Button,{variant:\"outline\",size:\"sm\",onClick:()=>navigate(`/parking-detail/${parkingId}`),className:\"text-yellow-500 border-yellow-500\",children:\"View Parking Details\"})]}),/*#__PURE__*/_jsx(Card,{title:\"\",subtitle:\"\",footer:\"\",image:\"\",onClick:()=>{},className:\"mb-6 border-none shadow-md overflow-hidden\",children:/*#__PURE__*/_jsx(\"div\",{className:\"border-l-4 border-yellow-400 pl-4\",children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start mb-2\",children:[/*#__PURE__*/_jsx(MapPinIcon,{className:\"h-5 w-5 text-yellow-500 flex-shrink-0 mt-0.5 mr-2\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"font-semibold text-lg\",children:parkingDetails===null||parkingDetails===void 0?void 0:parkingDetails.name}),/*#__PURE__*/_jsx(\"p\",{className:\"text-neutral-600 dark:text-neutral-400 text-sm\",children:parkingDetails===null||parkingDetails===void 0?void 0:parkingDetails.address})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start mb-2\",children:[/*#__PURE__*/_jsx(ClockIcon,{className:\"h-5 w-5 text-yellow-500 flex-shrink-0 mt-0.5 mr-2\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-neutral-600 dark:text-neutral-400 text-sm\",children:parkingDetails===null||parkingDetails===void 0?void 0:parkingDetails.hours}),/*#__PURE__*/_jsx(\"p\",{className:\"text-neutral-600 dark:text-neutral-400 text-sm\",children:parkingDetails===null||parkingDetails===void 0?void 0:parkingDetails.operatingTime})]})]})]})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-yellow-100 p-4 rounded-lg mb-6\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"font-medium text-center\",children:[\"Parking Availability: [\",parkingDetails===null||parkingDetails===void 0?void 0:parkingDetails.availableSlots,\"/\",parkingDetails===null||parkingDetails===void 0?void 0:parkingDetails.totalSlots,\"]\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center mt-1\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-xs text-gray-500\",children:pauseRefresh?\"Auto-refresh paused during slot selection\":`Auto-refreshes every ${REFRESH_INTERVAL/1000} seconds`}),/*#__PURE__*/_jsx(Button,{variant:\"ghost\",size:\"xs\",leftIcon:/*#__PURE__*/_jsx(ArrowPathIcon,{className:\"h-3 w-3\"}),onClick:refreshParkingData,className:\"ml-2\",children:\"Refresh Now\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-4\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-lg font-semibold\",children:\"Select a Parking Slot\"}),/*#__PURE__*/_jsx(Button,{size:\"sm\",variant:\"outline\",leftIcon:/*#__PURE__*/_jsx(ArrowPathIcon,{className:\"h-4 w-4\"}),onClick:refreshParkingData,children:\"Refresh\"})]}),isLoading?/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center py-8\",children:/*#__PURE__*/_jsx(Loading,{})}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-5 md:grid-cols-10 gap-1 mb-6 bg-yellow-50 p-3 rounded-lg\",children:parkingSlots.map(slot=>/*#__PURE__*/_jsx(\"div\",{className:`\n                    h-10 rounded flex items-center justify-center text-sm font-medium \n                    ${slot.status==='available'?selectedSlot&&selectedSlot.id===slot.id?'bg-yellow-200 text-black cursor-pointer':'bg-white border border-gray-300 hover:bg-yellow-100 cursor-pointer':'bg-black text-white cursor-not-allowed'}\n                  `,onClick:()=>handleSlotSelect(slot),children:slot.number},slot.id))}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center\",children:[/*#__PURE__*/_jsx(\"div\",{children:selectedSlot?/*#__PURE__*/_jsxs(\"p\",{className:\"font-medium\",children:[\"Selected Slot: \",/*#__PURE__*/_jsx(\"span\",{className:\"text-yellow-600\",children:selectedSlot.number})]}):/*#__PURE__*/_jsx(\"p\",{className:\"text-neutral-600 dark:text-neutral-400\",children:\"No slot selected\"})}),/*#__PURE__*/_jsxs(Button,{variant:\"primary\",disabled:!selectedSlot,onClick:handleBookClick,className:\"bg-yellow-400 hover:bg-yellow-500 border-yellow-500 text-black flex items-center\",children:[!isAuthenticated()&&/*#__PURE__*/_jsx(ShieldCheckIcon,{className:\"h-4 w-4 mr-1\"}),isAuthenticated()?\"Book Selected Slot\":\"Login & Book Selected Slot\"]})]})]})]}),/*#__PURE__*/_jsx(Modal,{isOpen:isBookingModalOpen,onClose:()=>{setIsBookingModalOpen(false);setPauseRefresh(false);setBookingComplete(false);},title:bookingComplete?\"Booking Confirmed!\":\"Confirm Booking\",size:\"md\",footer:bookingComplete?/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-center gap-4\",children:[/*#__PURE__*/_jsx(Button,{variant:\"outline\",onClick:handleCloseConfirmation,children:\"Back to Parking\"}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:downloadTicket,className:\"bg-blue-600 hover:bg-blue-700 text-white\",children:\"Download Ticket\"}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:handleGetDirections,className:\"bg-yellow-400 hover:bg-yellow-500 text-black\",children:\"Get Directions\"})]}):null,children:bookingComplete?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",ref:ticketRef,children:[/*#__PURE__*/_jsx(\"div\",{className:\"mb-4 flex justify-center\",children:/*#__PURE__*/_jsx(\"div\",{className:\"h-16 w-16 rounded-full bg-yellow-400 flex items-center justify-center\",children:/*#__PURE__*/_jsx(CheckCircleIcon,{className:\"h-10 w-10 text-white\"})})}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-semibold mb-4\",children:\"Your parking has been booked!\"}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-yellow-50 p-4 rounded-lg mb-6 text-left\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-y-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium\",children:\"Booking Reference:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"font-bold\",children:bookingReference}),/*#__PURE__*/_jsx(\"div\",{children:\"Name:\"}),/*#__PURE__*/_jsx(\"div\",{children:bookingForm.name}),/*#__PURE__*/_jsx(\"div\",{children:\"Vehicle Number:\"}),/*#__PURE__*/_jsx(\"div\",{children:bookingForm.vehicleNumber}),/*#__PURE__*/_jsx(\"div\",{children:\"Vehicle Type:\"}),/*#__PURE__*/_jsx(\"div\",{children:(_VEHICLE_TYPES$find2=VEHICLE_TYPES.find(v=>v.value===bookingForm.vehicleType))===null||_VEHICLE_TYPES$find2===void 0?void 0:_VEHICLE_TYPES$find2.label}),/*#__PURE__*/_jsx(\"div\",{children:\"Parking Spot:\"}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Slot \",selectedSlot===null||selectedSlot===void 0?void 0:selectedSlot.number]}),/*#__PURE__*/_jsx(\"div\",{children:\"Duration:\"}),/*#__PURE__*/_jsx(\"div\",{children:(_DURATION_OPTIONS$fin=DURATION_OPTIONS.find(d=>d.value===bookingForm.duration))===null||_DURATION_OPTIONS$fin===void 0?void 0:_DURATION_OPTIONS$fin.label}),/*#__PURE__*/_jsx(\"div\",{children:\"Payment Method:\"}),/*#__PURE__*/_jsx(\"div\",{children:(_PAYMENT_METHODS$find=PAYMENT_METHODS.find(p=>p.value===bookingForm.paymentMethod))===null||_PAYMENT_METHODS$find===void 0?void 0:_PAYMENT_METHODS$find.label}),/*#__PURE__*/_jsx(\"div\",{children:\"Date & Time:\"}),/*#__PURE__*/_jsx(\"div\",{children:new Date().toLocaleString(undefined,{year:'numeric',month:'numeric',day:'numeric',hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:true})}),/*#__PURE__*/_jsx(\"div\",{children:\"Rate:\"}),/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u20B9\",HOURLY_RATE,\"/hr\"]}),/*#__PURE__*/_jsx(\"div\",{children:\"Amount:\"}),/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u20B9\",calculatePrice(bookingForm.duration),\" (\\u20B9\",HOURLY_RATE,\"/hr x \",bookingForm.duration,\" \",parseInt(bookingForm.duration)===1?'hour':'hours',\")\"]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-gray-600 text-sm\",children:[\"A confirmation has been sent to your mobile number: \",bookingForm.mobileNumber]})]}):/*#__PURE__*/_jsx(\"div\",{children:isLoading?/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col items-center justify-center py-8\",children:[/*#__PURE__*/_jsx(Loading,{size:\"lg\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-4 text-center\",children:\"Processing your booking...\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"You are about to book:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between mt-2 p-3 bg-yellow-50 rounded-lg\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:parkingDetails===null||parkingDetails===void 0?void 0:parkingDetails.name}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600\",children:[\"Slot: \",selectedSlot===null||selectedSlot===void 0?void 0:selectedSlot.number]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"font-bold\",children:[\"\\u20B9\",calculatePrice(bookingForm.duration)]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600\",children:[bookingForm.duration,\" \",parseInt(bookingForm.duration)===1?'hour':'hours']})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium mb-2\",children:\"Customer Information\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"label\",{className:\"block text-sm font-medium mb-1\",children:[\"Full Name \",/*#__PURE__*/_jsx(\"span\",{className:\"text-red-500\",children:\"*\"})]}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"name\",value:bookingForm.name,onChange:handleInputChange,placeholder:\"Enter your full name\",className:\"w-full p-2 border border-gray-300 rounded-md\",required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"label\",{className:\"block text-sm font-medium mb-1\",children:[\"Vehicle Number \",/*#__PURE__*/_jsx(\"span\",{className:\"text-red-500\",children:\"*\"})]}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"vehicleNumber\",value:bookingForm.vehicleNumber,onChange:handleInputChange,placeholder:\"e.g. MH02AB1234\",className:\"w-full p-2 border border-gray-300 rounded-md\",required:true})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium mb-1\",children:\"Vehicle Type\"}),/*#__PURE__*/_jsx(\"select\",{name:\"vehicleType\",value:bookingForm.vehicleType,onChange:handleInputChange,className:\"w-full p-2 border border-gray-300 rounded-md\",children:VEHICLE_TYPES.map(type=>/*#__PURE__*/_jsx(\"option\",{value:type.value,children:type.label},type.value))})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"label\",{className:\"block text-sm font-medium mb-1\",children:[\"Mobile Number \",/*#__PURE__*/_jsx(\"span\",{className:\"text-red-500\",children:\"*\"})]}),/*#__PURE__*/_jsx(\"input\",{type:\"tel\",name:\"mobileNumber\",value:bookingForm.mobileNumber,onChange:handleInputChange,placeholder:\"10 digits mobile number\",className:\"w-full p-2 border border-gray-300 rounded-md\",maxLength:10,required:true,pattern:\"[0-9]{10}\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium mb-1\",children:\"Duration\"}),/*#__PURE__*/_jsx(\"select\",{name:\"duration\",value:bookingForm.duration,onChange:handleInputChange,className:\"w-full p-2 border border-gray-300 rounded-md\",children:DURATION_OPTIONS.map(option=>/*#__PURE__*/_jsxs(\"option\",{value:option.value,children:[option.label,\" - \\u20B9\",calculatePrice(option.value)]},option.value))})]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium mb-2\",children:\"Payment Method\"}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-2\",children:PAYMENT_METHODS.map(method=>/*#__PURE__*/_jsxs(\"label\",{className:\"flex items-center p-3 border rounded-md hover:bg-gray-50 cursor-pointer\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",name:\"paymentMethod\",value:method.value,checked:bookingForm.paymentMethod===method.value,onChange:handleInputChange,className:\"mr-2\"}),/*#__PURE__*/_jsx(\"span\",{children:method.label})]},method.value))})]}),bookingForm.paymentMethod==='card'&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4 border-t pt-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium mb-2\",children:\"Card Information\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium mb-1\",children:\"Card Number\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"cardNumber\",value:cardForm.cardNumber,onChange:handleCardInputChange,placeholder:\"1234 5678 9012 3456\",className:\"w-full p-2 border border-gray-300 rounded-md\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium mb-1\",children:\"Expiry Date\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"expiryDate\",value:cardForm.expiryDate,onChange:handleCardInputChange,placeholder:\"MM/YY\",className:\"w-full p-2 border border-gray-300 rounded-md\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium mb-1\",children:\"CVV\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"cvv\",value:cardForm.cvv,onChange:handleCardInputChange,placeholder:\"123\",className:\"w-full p-2 border border-gray-300 rounded-md\",maxLength:3})]})]})]})]}),bookingForm.paymentMethod==='upi'&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4 border-t pt-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium mb-2\",children:\"UPI Payment\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600 mb-2\",children:\"You'll receive a payment request on your UPI app after confirmation.\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center space-x-4 my-4\",children:[/*#__PURE__*/_jsx(\"img\",{src:\"/images/upi-icons/gpay.png\",alt:\"Google Pay\",className:\"h-8\"}),/*#__PURE__*/_jsx(\"img\",{src:\"/images/upi-icons/phonepe.png\",alt:\"PhonePe\",className:\"h-8\"}),/*#__PURE__*/_jsx(\"img\",{src:\"/images/upi-icons/paytm.png\",alt:\"Paytm\",className:\"h-8\"}),/*#__PURE__*/_jsx(\"img\",{src:\"/images/upi-icons/bhim.png\",alt:\"BHIM\",className:\"h-8\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end mt-6\",children:[/*#__PURE__*/_jsx(Button,{variant:\"outline\",onClick:()=>{setIsBookingModalOpen(false);setPauseRefresh(false);},className:\"mr-2\",children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:handleBooking,className:\"bg-yellow-400 hover:bg-yellow-500 text-black\",children:\"Confirm Booking\"})]})]})})}),/*#__PURE__*/_jsx(LoginModal,{isOpen:isLoginModalOpen,onClose:()=>{setIsLoginModalOpen(false);setPauseRefresh(false);// If user is authenticated and has a slot selected, open booking modal\nif(isAuthenticated()&&selectedSlot){setIsBookingModalOpen(true);}},onSignupClick:handleSignupClick}),/*#__PURE__*/_jsx(SignupModal,{isOpen:isSignupModalOpen,onClose:()=>{setIsSignupModalOpen(false);setPauseRefresh(false);},onLoginClick:()=>{setIsSignupModalOpen(false);setIsLoginModalOpen(true);}}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-center space-x-2 mt-8\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-2 h-2 rounded-full bg-gray-300\"}),/*#__PURE__*/_jsx(\"div\",{className:\"w-2 h-2 rounded-full bg-yellow-400\"}),/*#__PURE__*/_jsx(\"div\",{className:\"w-2 h-2 rounded-full bg-gray-300\"})]})]});};export default ParkingSlotPage;","map":{"version":3,"names":["React","useState","useEffect","useRef","useParams","useNavigate","useLocation","MapIcon","ClockIcon","CurrencyRupeeIcon","ArrowPathIcon","MapPinIcon","VideoCameraIcon","EyeIcon","CheckCircleIcon","AdjustmentsHorizontalIcon","ShieldCheckIcon","Card","Button","Input","Select","Badge","Loading","Alert","Modal","toast","useAuth","LoginModal","SignupModal","html2canvas","jsPDF","format","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","API_BASE_URL","HOURLY_RATE","REFRESH_INTERVAL","DURATION_OPTIONS","value","label","hours","VEHICLE_TYPES","PAYMENT_METHODS","LOCAL_VIDEOS","main","reverse","ParkingSlotPage","_location$state","_VEHICLE_TYPES$find2","_DURATION_OPTIONS$fin","_PAYMENT_METHODS$find","parkingId","navigate","location","isAuthenticated","user","passedParkingDetails","state","parkingDetails","isLoading","setIsLoading","setParkingDetails","parkingSlots","setParkingSlots","selectedSlot","setSelectedSlot","isBookingModalOpen","setIsBookingModalOpen","isLoginModalOpen","setIsLoginModalOpen","isSignupModalOpen","setIsSignupModalOpen","isAPIConnected","setIsAPIConnected","videoFeed","setVideoFeed","showVideo","setShowVideo","pauseRefresh","setPauseRefresh","lastRefreshTime","setLastRefreshTime","videoSource","setVideoSource","videoSources","setVideoSources","debugMode","setDebugMode","processingMode","setProcessingMode","viewMode","setViewMode","bookingForm","setBookingForm","name","vehicleNumber","vehicleType","mobileNumber","paymentMethod","duration","totalAmount","bookingComplete","setBookingComplete","bookingReference","setBookingReference","cardForm","setCardForm","cardNumber","expiryDate","cvv","cardName","ticketRef","fetchVideoFeed","response","fetch","window","protocol","hostname","method","ok","data","json","current_source","debug_mode","processing_mode","console","log","updateVideoFeedUrl","fetchVideoSources","Error","error","info","available","current","source","baseUrl","url","changeVideoSource","headers","body","JSON","stringify","success","toggleDebugMode","newDebugMode","enabled","setVideoProcessingMode","mode","changeViewMode","generateSlotsData","total","slots","availableSlots","length","randomSlot","Math","floor","random","includes","push","i","id","number","status","type","generateParkingSlots","address","coordinates","operatingTime","rates","hourly","hourlyRate","daily","parseInt","replace","features","split","totalSlots","fetchParkingDetails","intervalId","setInterval","fetchLiveData","Date","toLocaleTimeString","clearInterval","handleKeyDown","e","key","toLowerCase","addEventListener","removeEventListener","updateSlots","newSlots","prevSlots","map","slot","updatedSlot","find","s","handleSlotSelect","prev","spaces","Object","keys","apiSlots","entries","_ref","space","mockSlots","Array","from","_","index","isOccupied","availableSpots","filter","then","mockParkingDetails","operatingHours","catch","handleInputChange","target","price","calculatePrice","handleBookClick","warning","handleGetDirections","navigator","geolocation","getCurrentPosition","position","origin","coords","latitude","longitude","destination","open","enableHighAccuracy","timeout","maximumAge","downloadTicket","setTimeout","ticketElement","scale","useCORS","logging","backgroundColor","canvas","_VEHICLE_TYPES$find","pdf","orientation","unit","imgData","toDataURL","imgWidth","imgHeight","height","width","setFillColor","rect","setTextColor","setFont","setFontSize","text","align","addImage","v","setDrawColor","line","save","validateForm","trim","test","handleBooking","bookingData","slotId","slotNumber","reference","autoClose","hideProgressBar","closeOnClick","pauseOnHover","draggable","style","color","updatedSlots","refreshParkingData","toggleVideoFeed","handleCloseConfirmation","handleCardInputChange","handleSignupClick","handleLoginClick","className","children","size","variant","leftIcon","onClick","title","subtitle","footer","image","src","alt","autoPlay","muted","loop","controls","disabled","isOpen","onClose","ref","d","p","toLocaleString","undefined","year","month","day","hour","minute","second","hour12","onChange","placeholder","required","maxLength","pattern","option","checked","onSignupClick","onLoginClick"],"sources":["C:/Users/Lenovo/Documents/APICODE/spotsense/frontend/src/pages/ParkingSlotPage.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { useParams, useNavigate, useLocation } from 'react-router-dom';\r\nimport { MapIcon, ClockIcon, CurrencyRupeeIcon, ArrowPathIcon, MapPinIcon, VideoCameraIcon, EyeIcon, CheckCircleIcon, AdjustmentsHorizontalIcon, ShieldCheckIcon } from '@heroicons/react/24/outline';\r\nimport { Card, Button, Input, Select, Badge, Loading, Alert, Modal } from '../components/common';\r\nimport { toast } from 'react-toastify';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { LoginModal, SignupModal } from '../components/auth';\r\nimport html2canvas from 'html2canvas';\r\nimport jsPDF from 'jspdf';\r\nimport { format } from 'date-fns';\r\n\r\n// Set the base URL for the Python backend API\r\nconst API_BASE_URL = '/api'; // Use relative path for API requests\r\n\r\n// Add after the API_BASE_URL constant\r\nconst HOURLY_RATE = 40; // ₹40 per hour\r\nconst REFRESH_INTERVAL = 30000; // Increased to 30 seconds (from 10 seconds)\r\n\r\n// Duration options\r\nconst DURATION_OPTIONS = [\r\n  { value: '1', label: '1 Hour', hours: 1 },\r\n  { value: '2', label: '2 Hours', hours: 2 },\r\n  { value: '3', label: '3 Hours', hours: 3 },\r\n  { value: '4', label: '4 Hours', hours: 4 },\r\n  { value: '24', label: '24 Hours (Full Day)', hours: 24 }\r\n];\r\n\r\n// Vehicle types\r\nconst VEHICLE_TYPES = [\r\n  { value: 'car', label: 'Car' },\r\n  { value: 'bike', label: 'Bike/Scooter' },\r\n  { value: 'suv', label: 'SUV' },\r\n  { value: 'truck', label: 'Truck/Van' }\r\n];\r\n\r\n// Payment methods\r\nconst PAYMENT_METHODS = [\r\n  { value: 'upi', label: 'UPI' },\r\n  { value: 'card', label: 'Credit/Debit Card' },\r\n  { value: 'cash', label: 'Cash' }\r\n];\r\n\r\n// Add local video sources at the top of the file\r\nconst LOCAL_VIDEOS = {\r\n  main: '/videos/carPark.mp4',\r\n  reverse: '/videos/carPark_Reverse.mp4'\r\n};\r\n\r\nconst ParkingSlotPage = () => {\r\n  const { parkingId } = useParams();\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const { isAuthenticated, user } = useAuth();\r\n  \r\n  // Get parking details from location state if available\r\n  const passedParkingDetails = location.state?.parkingDetails;\r\n  \r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [parkingDetails, setParkingDetails] = useState(null);\r\n  const [parkingSlots, setParkingSlots] = useState([]);\r\n  const [selectedSlot, setSelectedSlot] = useState(null);\r\n  const [isBookingModalOpen, setIsBookingModalOpen] = useState(false);\r\n  const [isLoginModalOpen, setIsLoginModalOpen] = useState(false);\r\n  const [isSignupModalOpen, setIsSignupModalOpen] = useState(false);\r\n  const [isAPIConnected, setIsAPIConnected] = useState(false);\r\n  const [videoFeed, setVideoFeed] = useState(null);\r\n  const [showVideo, setShowVideo] = useState(false);\r\n  const [pauseRefresh, setPauseRefresh] = useState(false);\r\n  const [lastRefreshTime, setLastRefreshTime] = useState(null);\r\n  const [videoSource, setVideoSource] = useState('main');\r\n  const [videoSources, setVideoSources] = useState([]);\r\n  const [debugMode, setDebugMode] = useState(false);\r\n  const [processingMode, setProcessingMode] = useState('full');\r\n  const [viewMode, setViewMode] = useState('processed'); // 'processed', 'raw', 'grayscale', 'threshold'\r\n  \r\n  // Booking form\r\n  const [bookingForm, setBookingForm] = useState({\r\n    name: '',\r\n    vehicleNumber: '',\r\n    vehicleType: 'car',\r\n    mobileNumber: '',\r\n    paymentMethod: 'upi',\r\n    duration: '1',\r\n    totalAmount: HOURLY_RATE // Default to 1 hour rate\r\n  });\r\n  const [bookingComplete, setBookingComplete] = useState(false);\r\n  const [bookingReference, setBookingReference] = useState(null);\r\n\r\n  // Add card form state\r\n  const [cardForm, setCardForm] = useState({\r\n    cardNumber: '',\r\n    expiryDate: '',\r\n    cvv: '',\r\n    cardName: ''\r\n  });\r\n\r\n  // Add ticket ref for PDF generation\r\n  const ticketRef = useRef(null);\r\n\r\n  // Function to fetch video feed from the backend\r\n  const fetchVideoFeed = async () => {\r\n    try {\r\n      // Make a fetch request to check if the video API is available\r\n      const response = await fetch(`${window.location.protocol}//${window.location.hostname}:5000/api/parking/video/status`, {\r\n        method: 'GET',\r\n      });\r\n      \r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setVideoSource(data.current_source);\r\n        setDebugMode(data.debug_mode);\r\n        setProcessingMode(data.processing_mode);\r\n        console.log('Video status:', data);\r\n        \r\n        // Set the video feed URL directly to the streaming endpoint\r\n        updateVideoFeedUrl(data.current_source);\r\n        \r\n        // Also fetch available video sources\r\n        fetchVideoSources();\r\n        \r\n        setIsAPIConnected(true);\r\n      } else {\r\n        throw new Error('Video API not available');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error setting up video feed:', error);\r\n      // If API fails, set to use local video files as fallback\r\n      setVideoFeed(LOCAL_VIDEOS[videoSource || 'main']);\r\n      setIsAPIConnected(false);\r\n      toast.info(\"Using local video file as backend is not available\");\r\n    }\r\n  };\r\n  \r\n  const fetchVideoSources = async () => {\r\n    try {\r\n      const response = await fetch(`${window.location.protocol}//${window.location.hostname}:5000/api/parking/video/sources`);\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setVideoSources(data.available);\r\n        setVideoSource(data.current);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching video sources:', error);\r\n    }\r\n  };\r\n  \r\n  const updateVideoFeedUrl = (source) => {\r\n    const baseUrl = `${window.location.protocol}//${window.location.hostname}:5000/api/parking`;\r\n    \r\n    // Set URL based on view mode\r\n    let url;\r\n    switch (viewMode) {\r\n      case 'raw':\r\n        url = `${baseUrl}/video/raw`;\r\n        break;\r\n      case 'grayscale':\r\n        url = `${baseUrl}/video/grayscale`;\r\n        break;\r\n      case 'threshold':\r\n        url = `${baseUrl}/video/threshold`;\r\n        break;\r\n      case 'processed':\r\n      default:\r\n        url = `${baseUrl}/video`;\r\n    }\r\n    \r\n    setVideoFeed(url);\r\n    console.log('Video feed URL set to:', url);\r\n  };\r\n  \r\n  const changeVideoSource = async (source) => {\r\n    try {\r\n      if (isAPIConnected) {\r\n        const response = await fetch(`${window.location.protocol}//${window.location.hostname}:5000/api/parking/video/select`, {\r\n          method: 'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json'\r\n          },\r\n          body: JSON.stringify({ source })\r\n        });\r\n        \r\n        if (response.ok) {\r\n          const data = await response.json();\r\n          setVideoSource(data.current_source);\r\n          toast.success(`Video source changed to ${source}`);\r\n          // Refresh the feed URL\r\n          updateVideoFeedUrl(source);\r\n        } else {\r\n          throw new Error('Failed to change video source');\r\n        }\r\n      } else {\r\n        // Use local video sources when API is not connected\r\n        setVideoSource(source);\r\n        setVideoFeed(LOCAL_VIDEOS[source]);\r\n        toast.info(`Video source changed to ${source} (local file)`);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error changing video source:', error);\r\n      // Fallback to local videos\r\n      setVideoSource(source);\r\n      setVideoFeed(LOCAL_VIDEOS[source]);\r\n      toast.info(`Video source changed to ${source} (local file)`);\r\n    }\r\n  };\r\n  \r\n  const toggleDebugMode = async () => {\r\n    try {\r\n      const newDebugMode = !debugMode;\r\n      const response = await fetch(`${window.location.protocol}//${window.location.hostname}:5000/api/parking/video/debug`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify({ enabled: newDebugMode })\r\n      });\r\n      \r\n      if (response.ok) {\r\n        setDebugMode(newDebugMode);\r\n        toast.success(`Debug mode ${newDebugMode ? 'enabled' : 'disabled'}`);\r\n      } else {\r\n        throw new Error('Failed to toggle debug mode');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error toggling debug mode:', error);\r\n      toast.error('Failed to toggle debug mode');\r\n    }\r\n  };\r\n  \r\n  const setVideoProcessingMode = async (mode) => {\r\n    try {\r\n      const response = await fetch(`${window.location.protocol}//${window.location.hostname}:5000/api/parking/video/mode`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify({ mode })\r\n      });\r\n      \r\n      if (response.ok) {\r\n        setProcessingMode(mode);\r\n        toast.success(`Processing mode set to ${mode}`);\r\n      } else {\r\n        throw new Error('Failed to change processing mode');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error changing processing mode:', error);\r\n      toast.error('Failed to change processing mode');\r\n    }\r\n  };\r\n  \r\n  const changeViewMode = (mode) => {\r\n    setViewMode(mode);\r\n    updateVideoFeedUrl(videoSource);\r\n    toast.info(`View changed to ${mode}`);\r\n  };\r\n\r\n  // Use the generateSlotsData function to generate slot data without updating state\r\n  const generateSlotsData = (total, available) => {\r\n    const slots = [];\r\n    const availableSlots = [];\r\n    \r\n    // Generate random available slots\r\n    while (availableSlots.length < available) {\r\n      const randomSlot = Math.floor(Math.random() * total) + 1;\r\n      if (!availableSlots.includes(randomSlot)) {\r\n        availableSlots.push(randomSlot);\r\n      }\r\n    }\r\n    \r\n    // Create the slots array with status\r\n    for (let i = 1; i <= total; i++) {\r\n      slots.push({\r\n        id: i,\r\n        number: i,\r\n        status: availableSlots.includes(i) ? 'available' : 'occupied',\r\n        type: i % 5 === 0 ? 'handicapped' : i % 7 === 0 ? 'electric' : 'standard'\r\n      });\r\n    }\r\n    \r\n    return slots;\r\n  };\r\n\r\n  // Remove the old duplicate generateParkingSlots function and update this one\r\n  const generateParkingSlots = (total, available) => {\r\n    const slots = generateSlotsData(total, available);\r\n    setParkingSlots(slots);\r\n    return slots;\r\n  };\r\n\r\n  useEffect(() => {\r\n    // Check if we have parking details passed from the previous page\r\n    if (passedParkingDetails) {\r\n      // Use the passed parking details\r\n      setParkingDetails({\r\n        id: passedParkingDetails.id,\r\n        name: passedParkingDetails.name,\r\n        address: passedParkingDetails.address,\r\n        coordinates: passedParkingDetails.coordinates,\r\n        hours: passedParkingDetails.hours,\r\n        operatingTime: passedParkingDetails.hours,\r\n        rates: {\r\n          hourly: passedParkingDetails.hourlyRate,\r\n          daily: `₹${parseInt(passedParkingDetails.hourlyRate.replace('₹', '').replace('/hr', '')) * 5}/day`\r\n        },\r\n        features: passedParkingDetails.features ? passedParkingDetails.features.split(', ') : [],\r\n        totalSlots: 69, // Always set to 69 total spots\r\n        availableSlots: passedParkingDetails.available,\r\n        type: passedParkingDetails.type\r\n      });\r\n      \r\n      // Generate parking slots based on the passed details\r\n      generateParkingSlots(69, passedParkingDetails.available);\r\n      \r\n      setIsLoading(false);\r\n    } else {\r\n      // Fallback to fetching parking details\r\n      fetchParkingDetails();\r\n    }\r\n\r\n    // Attempt to load the video feed\r\n    fetchVideoFeed();\r\n\r\n    // Set up interval to periodically refresh data with longer interval\r\n    const intervalId = setInterval(() => {\r\n      // Only refresh if not paused (user is not in booking process)\r\n      if (!pauseRefresh && !passedParkingDetails) {\r\n        fetchLiveData();\r\n        setLastRefreshTime(new Date().toLocaleTimeString());\r\n      }\r\n    }, REFRESH_INTERVAL);\r\n\r\n    // Clean up interval on unmount\r\n    return () => clearInterval(intervalId);\r\n  }, [parkingId, passedParkingDetails, pauseRefresh]);\r\n  \r\n  // Effect to update video feed URL when view mode changes\r\n  useEffect(() => {\r\n    if (videoFeed) {\r\n      updateVideoFeedUrl(videoSource);\r\n    }\r\n  }, [viewMode]);\r\n  \r\n  // Effect to pause refresh when booking modal is open\r\n  useEffect(() => {\r\n    setPauseRefresh(isBookingModalOpen);\r\n  }, [isBookingModalOpen]);\r\n\r\n  // Add keyboard event listener for debug mode\r\n  useEffect(() => {\r\n    const handleKeyDown = (e) => {\r\n      // Only respond to keyboard events when video is showing\r\n      if (!showVideo) return;\r\n      \r\n      // 'D' key toggles debug mode\r\n      if (e.key.toLowerCase() === 'd') {\r\n        toggleDebugMode();\r\n      }\r\n    };\r\n    \r\n    window.addEventListener('keydown', handleKeyDown);\r\n    \r\n    // Clean up\r\n    return () => {\r\n      window.removeEventListener('keydown', handleKeyDown);\r\n    };\r\n  }, [showVideo, debugMode]);\r\n\r\n  // Update slots when live data comes in\r\n  const updateSlots = (newSlots) => {\r\n    setParkingSlots(prevSlots => {\r\n      return prevSlots.map(slot => {\r\n        const updatedSlot = newSlots.find(s => s.id === slot.id);\r\n        return updatedSlot || slot;\r\n      });\r\n    });\r\n  };\r\n\r\n  const handleSlotSelect = (slot) => {\r\n    // Don't select occupied slots\r\n    if (slot.status === 'occupied') return;\r\n    \r\n    // Toggle selection\r\n    if (selectedSlot && selectedSlot.id === slot.id) {\r\n      setSelectedSlot(null);\r\n    } else {\r\n      setSelectedSlot(slot);\r\n    }\r\n  };\r\n\r\n  const fetchLiveData = async () => {\r\n    // Don't fetch if booking modal is open\r\n    if (isBookingModalOpen) return;\r\n    \r\n    try {\r\n      // Try to connect to the Python backend API for real-time video processing\r\n      const response = await fetch(`${API_BASE_URL}/parking/spaces${parkingDetails?.id ? `?parkingId=${parkingDetails.id}` : ''}`);\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(`HTTP error! Status: ${response.status}`);\r\n      }\r\n      \r\n      const data = await response.json();\r\n      \r\n      if (data) {\r\n        setIsAPIConnected(true);\r\n        console.log('Raw API response:', data); // Log the raw response for debugging\r\n        \r\n        // Update available spots count based on real data\r\n        if (parkingDetails) {\r\n          setParkingDetails(prev => ({\r\n            ...prev,\r\n            availableSlots: data.available,\r\n            totalSlots: data.total || 69 // Use total from API if available\r\n          }));\r\n        }\r\n        \r\n        // Transform API data to match our slot format\r\n        if (data.spaces && Object.keys(data.spaces).length > 0) {\r\n          // If real spaces data is provided, convert from object to array\r\n          const apiSlots = Object.entries(data.spaces).map(([id, space]) => ({\r\n            id: parseInt(id),\r\n            number: parseInt(id) + 1, // Slot numbers start from 1\r\n            status: space.status === 'available' ? 'available' : 'occupied',\r\n            type: parseInt(id) % 5 === 0 ? 'premium' : 'standard'\r\n          }));\r\n          \r\n          console.log('Transformed API slots:', apiSlots); // Log for debugging\r\n          updateSlots(apiSlots);\r\n        } else {\r\n          // If only count is provided, create slots with random occupied/available\r\n          console.log('Using counts to generate random slots: total=', data.total, 'available=', data.available);\r\n          const newSlots = generateSlotsData(data.total || 69, data.available);\r\n          updateSlots(newSlots);\r\n        }\r\n        \r\n        setIsLoading(false);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching live parking data from video system:', error);\r\n      \r\n      // If API call fails, use mock data as fallback\r\n      if (!isAPIConnected) {\r\n        console.log('Falling back to mock data');\r\n        const mockSlots = Array.from({ length: 69 }, (_, index) => {\r\n          // Use a deterministic pattern for occupied slots\r\n          const isOccupied = [3, 7, 10, 14, 19, 20, 22, 25, 31, 33, 39, 42, 44, 47, 50, 52, 56, 58, 60, 63, 67].includes(index);\r\n          return {\r\n            id: index,\r\n            number: index + 1,\r\n            status: isOccupied ? 'occupied' : 'available',\r\n            type: index % 5 === 0 ? 'premium' : 'standard'\r\n          };\r\n        });\r\n        \r\n        updateSlots(mockSlots);\r\n        \r\n        // Update parking details to show correct number of available spots\r\n        if (parkingDetails) {\r\n          const availableSpots = mockSlots.filter(slot => slot.status === 'available').length;\r\n          setParkingDetails(prev => ({\r\n            ...prev,\r\n            availableSlots: availableSpots,\r\n            totalSlots: 69 // Always 69 total\r\n          }));\r\n        }\r\n        \r\n        setIsLoading(false);\r\n      }\r\n    }\r\n  };\r\n\r\n  const fetchParkingDetails = () => {\r\n    // Fetch parking details from an API\r\n    setIsLoading(true);\r\n    \r\n    fetch(`${API_BASE_URL}/parking/details/${parkingId}`)\r\n      .then(response => {\r\n        // If the API endpoint doesn't exist yet, we'll proceed with mock data\r\n        if (!response.ok) {\r\n          // Create mock data\r\n          const mockParkingDetails = {\r\n            id: parkingId,\r\n            name: 'Central Mall Parking',\r\n            address: '123 Main Street, City Center',\r\n            totalSlots: 40,\r\n            availableSlots: 15,\r\n            rates: {\r\n              hourly: '₹50/hour',\r\n              daily: '₹400/day'\r\n            },\r\n            operatingHours: '6:00 AM - 10:00 PM'\r\n          };\r\n          \r\n          return mockParkingDetails;\r\n        }\r\n        \r\n        return response.json();\r\n      })\r\n      .then(data => {\r\n        setParkingDetails(data);\r\n        \r\n        // Generate parking slots based on the data\r\n        generateParkingSlots(data.totalSlots, data.availableSlots);\r\n        \r\n        setIsLoading(false);\r\n      })\r\n      .catch(error => {\r\n        console.error('Error fetching parking details:', error);\r\n        \r\n        // Fallback to mock data on error\r\n        const mockParkingDetails = {\r\n          id: parkingId,\r\n          name: 'Central Mall Parking',\r\n          address: '123 Main Street, City Center',\r\n          totalSlots: 40,\r\n          availableSlots: 15,\r\n          rates: {\r\n            hourly: '₹50/hour',\r\n            daily: '₹400/day'\r\n          },\r\n          operatingHours: '6:00 AM - 10:00 PM'\r\n        };\r\n        \r\n        setParkingDetails(mockParkingDetails);\r\n        generateParkingSlots(mockParkingDetails.totalSlots, mockParkingDetails.availableSlots);\r\n        setIsLoading(false);\r\n      });\r\n  };\r\n\r\n  const handleInputChange = (e) => {\r\n    const { name, value } = e.target;\r\n    setBookingForm(prev => ({\r\n      ...prev,\r\n      [name]: value\r\n    }));\r\n    \r\n    // Calculate price when duration changes\r\n    if (name === 'duration') {\r\n      const price = calculatePrice(value);\r\n      setBookingForm(prev => ({\r\n        ...prev,\r\n        totalAmount: price\r\n      }));\r\n    }\r\n  };\r\n\r\n  const handleBookClick = () => {\r\n    // Check if user is authenticated\r\n    if (!isAuthenticated()) {\r\n      toast.warning(\"Please login to book a parking slot\");\r\n      setIsLoginModalOpen(true);\r\n      return;\r\n    }\r\n    \r\n    // Proceed with booking if authenticated\r\n    setIsBookingModalOpen(true);\r\n  };\r\n\r\n  const handleGetDirections = () => {\r\n    // Try to get user's current location for better directions\r\n    if (navigator.geolocation) {\r\n      navigator.geolocation.getCurrentPosition(\r\n        (position) => {\r\n          const origin = `${position.coords.latitude},${position.coords.longitude}`;\r\n          const destination = `${parkingDetails.coordinates[0]},${parkingDetails.coordinates[1]}`;\r\n          \r\n          // Open Google Maps with directions from current location to parking\r\n          window.open(\r\n            `https://www.google.com/maps/dir/?api=1&origin=${origin}&destination=${destination}`,\r\n            '_blank'\r\n          );\r\n          \r\n          toast.success(\"Directions loaded with your current location\");\r\n        },\r\n        (error) => {\r\n          console.error(\"Error getting user location:\", error);\r\n          \r\n          // Fallback to just opening the destination\r\n          window.open(\r\n            `https://www.google.com/maps/dir/?api=1&destination=${parkingDetails.coordinates[0]},${parkingDetails.coordinates[1]}`,\r\n            '_blank'\r\n          );\r\n          \r\n          toast.info(\"Using default directions without your current location\");\r\n        },\r\n        { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 }\r\n      );\r\n    } else {\r\n      // Browser doesn't support geolocation\r\n      window.open(\r\n        `https://www.google.com/maps/search/?api=1&query=${parkingDetails.coordinates[0]},${parkingDetails.coordinates[1]}`,\r\n        '_blank'\r\n      );\r\n      \r\n      toast.warning(\"Your browser doesn't support geolocation\");\r\n    }\r\n  };\r\n\r\n  const downloadTicket = () => {\r\n    toast.info(\"Generating your PDF ticket...\");\r\n    \r\n    // Wait for the next render cycle to ensure the ticket content is fully rendered\r\n    setTimeout(() => {\r\n      const ticketElement = ticketRef.current;\r\n      \r\n      if (!ticketElement) {\r\n        toast.error(\"Could not generate ticket\");\r\n        return;\r\n      }\r\n      \r\n      // Use html2canvas to capture the ticket as an image\r\n      html2canvas(ticketElement, {\r\n        scale: 2, // Higher scale for better quality\r\n        useCORS: true,\r\n        logging: false,\r\n        backgroundColor: '#ffffff'\r\n      }).then(canvas => {\r\n        try {\r\n          // Create a new PDF document\r\n          const pdf = new jsPDF({\r\n            orientation: 'portrait',\r\n            unit: 'mm',\r\n            format: 'a4'\r\n          });\r\n          \r\n          // Get image from canvas and add to PDF\r\n          const imgData = canvas.toDataURL('image/png');\r\n          const imgWidth = 190; // Width in mm (A4 is 210mm wide, leaving margin)\r\n          const imgHeight = (canvas.height * imgWidth) / canvas.width;\r\n          \r\n          // Add company logo/header\r\n          pdf.setFillColor(255, 204, 0); // Yellow header\r\n          pdf.rect(0, 0, 210, 20, 'F');\r\n          pdf.setTextColor(0, 0, 0);\r\n          pdf.setFont('helvetica', 'bold');\r\n          pdf.setFontSize(16);\r\n          pdf.text('SpotSense - Smart Parking', 105, 12, { align: 'center' });\r\n          \r\n          // Add image of the ticket\r\n          pdf.addImage(imgData, 'PNG', 10, 30, imgWidth, imgHeight);\r\n          \r\n          // Add customer details\r\n          pdf.setFontSize(12);\r\n          pdf.setFont('helvetica', 'normal');\r\n          pdf.text(`Name: ${bookingForm.name}`, 20, imgHeight + 40);\r\n          pdf.text(`Vehicle: ${bookingForm.vehicleNumber} (${VEHICLE_TYPES.find(v => v.value === bookingForm.vehicleType)?.label})`, 20, imgHeight + 48);\r\n          pdf.text(`Mobile: ${bookingForm.mobileNumber}`, 20, imgHeight + 56);\r\n          pdf.text(`Duration: ${bookingForm.duration} ${parseInt(bookingForm.duration) === 1 ? 'hour' : 'hours'}`, 20, imgHeight + 64);\r\n          pdf.text(`Amount Paid: ₹${calculatePrice(bookingForm.duration)}`, 20, imgHeight + 72);\r\n          \r\n          // Add footer\r\n          pdf.setDrawColor(200, 200, 200);\r\n          pdf.line(10, 280, 200, 280);\r\n          pdf.setFontSize(10);\r\n          pdf.setTextColor(100, 100, 100);\r\n          pdf.text('Thank you for using SpotSense. Drive safely!', 105, 288, { align: 'center' });\r\n          \r\n          // Save PDF\r\n          pdf.save(`SpotSense_Parking_Ticket_${bookingReference}.pdf`);\r\n          \r\n          toast.success(\"Ticket downloaded successfully!\");\r\n        } catch (error) {\r\n          console.error(\"Error generating PDF: \", error);\r\n          toast.error(\"Error generating PDF ticket. Please try again.\");\r\n        }\r\n      }).catch(error => {\r\n        console.error(\"Error capturing ticket: \", error);\r\n        toast.error(\"Error generating ticket. Please try again.\");\r\n      });\r\n    }, 500);\r\n  };\r\n\r\n  const validateForm = () => {\r\n    const { name, vehicleNumber, mobileNumber } = bookingForm;\r\n    \r\n    if (!name.trim()) {\r\n      toast.error(\"Please enter your name\");\r\n      return false;\r\n    }\r\n    \r\n    if (!vehicleNumber.trim()) {\r\n      toast.error(\"Please enter your vehicle number\");\r\n      return false;\r\n    }\r\n    \r\n    // Validate mobile number (exactly 10 digits)\r\n    if (!/^\\d{10}$/.test(mobileNumber.trim())) {\r\n      toast.error(\"Please enter a valid 10-digit mobile number\");\r\n      return false;\r\n    }\r\n    \r\n    return true;\r\n  };\r\n\r\n  const handleBooking = () => {\r\n    if (!validateForm()) {\r\n      return;\r\n    }\r\n    \r\n    setIsLoading(true);\r\n    \r\n    // Create booking data\r\n    const bookingData = {\r\n      parkingId: parkingDetails?.id,\r\n      slotId: selectedSlot?.id,\r\n      slotNumber: selectedSlot?.number,\r\n      name: bookingForm.name,\r\n      vehicleNumber: bookingForm.vehicleNumber,\r\n      vehicleType: bookingForm.vehicleType,\r\n      mobileNumber: bookingForm.mobileNumber,\r\n      duration: bookingForm.duration,\r\n      totalAmount: calculatePrice(bookingForm.duration)\r\n    };\r\n    \r\n    // Use fetch to simulate API call to book parking\r\n    // In a real app, you would make an actual API call to your backend\r\n    fetch(`${API_BASE_URL}/parking/book`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify(bookingData)\r\n    })\r\n    .then(response => {\r\n      // If the API doesn't exist yet, we'll proceed with mock data\r\n      // In a real app, you would only proceed if response.ok is true\r\n      return response.ok ? response.json() : { \r\n        success: true, \r\n        reference: `BK${Math.floor(Math.random() * 900000) + 100000}`\r\n      };\r\n    })\r\n    .then(data => {\r\n      // Set the booking reference from the response or use the mock one\r\n      setBookingReference(data.reference);\r\n      \r\n      setBookingComplete(true);\r\n      setIsLoading(false);\r\n      \r\n      // Display success toast\r\n      toast.success(\"Booking successful!\", {\r\n        position: \"bottom-right\",\r\n        autoClose: 3000,\r\n        hideProgressBar: false,\r\n        closeOnClick: true,\r\n        pauseOnHover: true,\r\n        draggable: true,\r\n        style: {\r\n          backgroundColor: \"#ffffff\",\r\n          color: \"#333333\"\r\n        }\r\n      });\r\n      \r\n      // Update the parking slot status to booked\r\n      if (selectedSlot) {\r\n        const updatedSlots = parkingSlots.map(slot => {\r\n          if (slot.id === selectedSlot.id) {\r\n            return { ...slot, status: 'occupied' };\r\n          }\r\n          return slot;\r\n        });\r\n        \r\n        setParkingSlots(updatedSlots);\r\n        \r\n        // Update available count\r\n        if (parkingDetails) {\r\n          setParkingDetails(prev => ({\r\n            ...prev,\r\n            availableSlots: prev.availableSlots - 1\r\n          }));\r\n        }\r\n      }\r\n    })\r\n    .catch(error => {\r\n      console.error('Error booking parking spot:', error);\r\n      toast.error('Failed to book parking spot. Please try again.');\r\n      setIsLoading(false);\r\n    });\r\n  };\r\n\r\n  // Add to renderContent\r\n  const refreshParkingData = () => {\r\n    setIsLoading(true);\r\n    \r\n    // Reset API connection status to force a fresh attempt\r\n    setIsAPIConnected(false);\r\n    \r\n    // Use the actual API endpoint\r\n    fetch(`${API_BASE_URL}/parking/status`)\r\n      .then(response => {\r\n        if (!response.ok) {\r\n          throw new Error(`HTTP error! Status: ${response.status}`);\r\n        }\r\n        // If successful, fetch the full data\r\n        fetchLiveData();\r\n        setLastRefreshTime(new Date().toLocaleTimeString());\r\n        toast.success(\"Parking data refreshed successfully!\");\r\n      })\r\n      .catch(error => {\r\n        console.error('Error refreshing parking data:', error);\r\n        \r\n        // Try the spaces endpoint directly as backup\r\n        fetchLiveData();\r\n        setLastRefreshTime(new Date().toLocaleTimeString());\r\n        toast.info(\"Using latest available parking data\");\r\n      });\r\n  };\r\n\r\n  const toggleVideoFeed = () => {\r\n    setShowVideo(!showVideo);\r\n  };\r\n\r\n  // Calculate price based on duration\r\n  const calculatePrice = (hours) => {\r\n    return HOURLY_RATE * parseInt(hours);\r\n  };\r\n\r\n  // Close button handler for booking confirmation modal\r\n  const handleCloseConfirmation = () => {\r\n    setIsBookingModalOpen(false);\r\n    setBookingComplete(false);\r\n    setSelectedSlot(null);\r\n    setPauseRefresh(false); // Resume auto-refresh\r\n    fetchLiveData();\r\n  };\r\n\r\n  // Add handler for card form changes\r\n  const handleCardInputChange = (e) => {\r\n    const { name, value } = e.target;\r\n    setCardForm(prev => ({\r\n      ...prev,\r\n      [name]: value\r\n    }));\r\n  };\r\n\r\n  // Add function to handle signup click\r\n  const handleSignupClick = () => {\r\n    setIsLoginModalOpen(false);\r\n    setIsSignupModalOpen(true);\r\n  };\r\n  \r\n  // Add function to handle login click\r\n  const handleLoginClick = () => {\r\n    setIsSignupModalOpen(false);\r\n    setIsLoginModalOpen(true);\r\n  };\r\n\r\n  // Add this useEffect to watch for authentication changes\r\n  useEffect(() => {\r\n    // If a slot is selected and user just logged in, show booking modal\r\n    if (selectedSlot && isAuthenticated() && isLoginModalOpen) {\r\n      setIsLoginModalOpen(false);\r\n      setIsBookingModalOpen(true);\r\n      toast.success(\"Login successful! You can now book your selected slot.\");\r\n    }\r\n  }, [isAuthenticated, selectedSlot, isLoginModalOpen]);\r\n\r\n  if (isLoading && !parkingDetails) {\r\n    return (\r\n      <div className=\"flex flex-col items-center justify-center h-[70vh]\">\r\n        <Loading size=\"lg\" />\r\n        <p className=\"mt-4 text-neutral-600 dark:text-neutral-400\">Loading parking details...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"max-w-4xl mx-auto\">\r\n      {/* Header */}\r\n      <div className=\"bg-yellow-400 rounded-lg p-6 mb-6\">\r\n        <h1 className=\"text-2xl font-bold text-center\">SpotSense</h1>\r\n        <p className=\"text-center text-black mt-1 text-sm\">Select and book your exact parking spot</p>\r\n        {isAPIConnected && (\r\n          <div className=\"flex items-center justify-center mt-2\">\r\n            <span className=\"inline-block h-2 w-2 rounded-full bg-green-500 mr-2\"></span>\r\n            <span className=\"text-xs text-black\">Live data connected</span>\r\n            {lastRefreshTime && (\r\n              <span className=\"text-xs text-black ml-4\">Last updated: {lastRefreshTime}</span>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n      \r\n      {/* Video Feed Toggle Button */}\r\n      <div className=\"flex justify-end mb-4 space-x-2\">\r\n        <Button\r\n          variant=\"outline\"\r\n          size=\"sm\"\r\n          leftIcon={<VideoCameraIcon className=\"h-4 w-4\" />}\r\n          onClick={toggleVideoFeed}\r\n          className=\"border-yellow-500 text-yellow-600\"\r\n        >\r\n          {showVideo ? \"Hide Video Feed\" : \"Show Video Feed\"}\r\n        </Button>\r\n        {isAPIConnected && showVideo && (\r\n          <Button\r\n            variant=\"outline\"\r\n            size=\"sm\"\r\n            leftIcon={<AdjustmentsHorizontalIcon className=\"h-4 w-4\" />}\r\n            onClick={toggleDebugMode}\r\n            className={debugMode ? \"border-green-500 text-green-600\" : \"border-gray-500 text-gray-600\"}\r\n          >\r\n            {debugMode ? \"Disable Debug View\" : \"Enable Debug View\"}\r\n          </Button>\r\n        )}\r\n      </div>\r\n      \r\n      {/* Video Feed Display */}\r\n      {showVideo && (\r\n        <Card \r\n          title=\"\"\r\n          subtitle=\"\"\r\n          footer=\"\"\r\n          image=\"\"\r\n          onClick={() => {}}\r\n          className=\"mb-6 overflow-hidden\"\r\n        >\r\n          <div className=\"relative pt-[56.25%]\"> {/* 16:9 aspect ratio */}\r\n            {isAPIConnected ? (\r\n              // Use img tag for real-time MJPEG stream from backend\r\n              <img \r\n                className=\"absolute top-0 left-0 w-full h-full object-cover\"\r\n                src={videoFeed || `${window.location.protocol}//${window.location.hostname}:5000/api/parking/video`}\r\n                alt=\"Live parking feed\"\r\n              />\r\n            ) : (\r\n              // Fallback to local video tag when API is not available\r\n              <video \r\n                className=\"absolute top-0 left-0 w-full h-full object-cover\"\r\n                src={videoFeed || LOCAL_VIDEOS.main}\r\n                autoPlay\r\n                muted\r\n                loop\r\n                controls\r\n              />\r\n            )}\r\n            <div className=\"absolute top-2 right-2 bg-black/50 text-white text-xs px-2 py-1 rounded-full flex items-center\">\r\n              <EyeIcon className=\"h-3 w-3 mr-1\" />\r\n              <span>{isAPIConnected ? \"Live Feed\" : \"Local Video\"}</span>\r\n            </div>\r\n            \r\n            {/* Video controls overlay at bottom */}\r\n            <div className=\"absolute bottom-0 left-0 right-0 bg-black/50 text-white text-xs p-2\">\r\n              <div className=\"flex flex-wrap justify-between items-center\">\r\n                {/* Video sources */}\r\n                <div className=\"flex items-center space-x-2 mb-1\">\r\n                  <span>Source:</span>\r\n                  <div className=\"flex space-x-1\">\r\n                    {videoSources.length > 0 ? (\r\n                      videoSources.map((source) => (\r\n                        <button\r\n                          key={source.id}\r\n                          onClick={() => changeVideoSource(source.id)}\r\n                          className={`px-2 py-1 rounded text-xs ${\r\n                            videoSource === source.id\r\n                              ? 'bg-yellow-500 text-black'\r\n                              : 'bg-gray-700'\r\n                          }`}\r\n                        >\r\n                          {source.name}\r\n                        </button>\r\n                      ))\r\n                    ) : (\r\n                      <>\r\n                        <button\r\n                          onClick={() => changeVideoSource('main')}\r\n                          className={`px-2 py-1 rounded text-xs ${\r\n                            videoSource === 'main' ? 'bg-yellow-500 text-black' : 'bg-gray-700'\r\n                          }`}\r\n                        >\r\n                          Main Parking\r\n                        </button>\r\n                        <button\r\n                          onClick={() => changeVideoSource('reverse')}\r\n                          className={`px-2 py-1 rounded text-xs ${\r\n                            videoSource === 'reverse' ? 'bg-yellow-500 text-black' : 'bg-gray-700'\r\n                          }`}\r\n                        >\r\n                          Reverse Angle\r\n                        </button>\r\n                      </>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n                \r\n                {/* View modes - only show when API is connected */}\r\n                {isAPIConnected && (\r\n                  <div className=\"flex items-center space-x-2 mb-1\">\r\n                    <span>View:</span>\r\n                    <div className=\"flex space-x-1\">\r\n                      <button\r\n                        onClick={() => changeViewMode('processed')}\r\n                        className={`px-2 py-1 rounded text-xs ${\r\n                          viewMode === 'processed' ? 'bg-yellow-500 text-black' : 'bg-gray-700'\r\n                        }`}\r\n                      >\r\n                        Processed\r\n                      </button>\r\n                      <button\r\n                        onClick={() => changeViewMode('raw')}\r\n                        className={`px-2 py-1 rounded text-xs ${\r\n                          viewMode === 'raw' ? 'bg-yellow-500 text-black' : 'bg-gray-700'\r\n                        }`}\r\n                      >\r\n                        Raw\r\n                      </button>\r\n                      <button\r\n                        onClick={() => changeViewMode('grayscale')}\r\n                        className={`px-2 py-1 rounded text-xs ${\r\n                          viewMode === 'grayscale' ? 'bg-yellow-500 text-black' : 'bg-gray-700'\r\n                        }`}\r\n                      >\r\n                        Grayscale\r\n                      </button>\r\n                      <button\r\n                        onClick={() => changeViewMode('threshold')}\r\n                        className={`px-2 py-1 rounded text-xs ${\r\n                          viewMode === 'threshold' ? 'bg-yellow-500 text-black' : 'bg-gray-700'\r\n                        }`}\r\n                      >\r\n                        Threshold\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div className=\"p-3 bg-gray-100 text-gray-800 text-sm\">\r\n            <p className=\"font-medium\">{isAPIConnected ? \"Live Video Feed\" : \"Local Video Playback\"}</p>\r\n            <p className=\"text-xs mt-1\">\r\n              {isAPIConnected ? (\r\n                <>\r\n                  • Click on parking spaces in the video to select or deselect them (pink box)\r\n                  <br />\r\n                  • Press 'D' key while viewing to show all processing steps (original, grayscale, threshold, dilated)\r\n                  <br />\r\n                  • Change video source or view type using the controls above\r\n                </>\r\n              ) : (\r\n                <>\r\n                  • Using local video files as the backend is not connected\r\n                  <br />\r\n                  • Switch between Main and Reverse angle views using the controls above\r\n                  <br />\r\n                  • Start the backend server to enable live processing\r\n                </>\r\n              )}\r\n            </p>\r\n          </div>\r\n        </Card>\r\n      )}\r\n      \r\n      {/* Parking Details */}\r\n      <div className=\"mb-6\">\r\n        <div className=\"flex items-center mb-4\">\r\n          <Button \r\n            variant=\"outline\" \r\n            size=\"sm\" \r\n            onClick={() => navigate('/')}\r\n            className=\"mr-4\"\r\n          >\r\n            Back to List\r\n          </Button>\r\n          <Button \r\n            variant=\"outline\" \r\n            size=\"sm\" \r\n            onClick={() => navigate(`/parking-detail/${parkingId}`)}\r\n            className=\"text-yellow-500 border-yellow-500\"\r\n          >\r\n            View Parking Details\r\n          </Button>\r\n        </div>\r\n        \r\n        <Card \r\n          title=\"\"\r\n          subtitle=\"\"\r\n          footer=\"\"\r\n          image=\"\"\r\n          onClick={() => {}}\r\n          className=\"mb-6 border-none shadow-md overflow-hidden\"\r\n        >\r\n          <div className=\"border-l-4 border-yellow-400 pl-4\">\r\n            <div>\r\n              <div className=\"flex items-start mb-2\">\r\n                <MapPinIcon className=\"h-5 w-5 text-yellow-500 flex-shrink-0 mt-0.5 mr-2\" />\r\n                <div>\r\n                  <h2 className=\"font-semibold text-lg\">{parkingDetails?.name}</h2>\r\n                  <p className=\"text-neutral-600 dark:text-neutral-400 text-sm\">{parkingDetails?.address}</p>\r\n                </div>\r\n              </div>\r\n              \r\n              <div className=\"flex items-start mb-2\">\r\n                <ClockIcon className=\"h-5 w-5 text-yellow-500 flex-shrink-0 mt-0.5 mr-2\" />\r\n                <div>\r\n                  <p className=\"text-neutral-600 dark:text-neutral-400 text-sm\">{parkingDetails?.hours}</p>\r\n                  <p className=\"text-neutral-600 dark:text-neutral-400 text-sm\">{parkingDetails?.operatingTime}</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </Card>\r\n        \r\n        {/* Parking availability */}\r\n        <div className=\"bg-yellow-100 p-4 rounded-lg mb-6\">\r\n          <p className=\"font-medium text-center\">Parking Availability: [{parkingDetails?.availableSlots}/{parkingDetails?.totalSlots}]</p>\r\n          <div className=\"flex items-center justify-center mt-1\">\r\n            <span className=\"text-xs text-gray-500\">\r\n              {pauseRefresh \r\n                ? \"Auto-refresh paused during slot selection\" \r\n                : `Auto-refreshes every ${REFRESH_INTERVAL/1000} seconds`\r\n              }\r\n            </span>\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"xs\"\r\n              leftIcon={<ArrowPathIcon className=\"h-3 w-3\" />}\r\n              onClick={refreshParkingData}\r\n              className=\"ml-2\"\r\n            >\r\n              Refresh Now\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Parking Slots Section */}\r\n      <div className=\"mb-8\">\r\n        <div className=\"flex justify-between items-center mb-4\">\r\n          <h2 className=\"text-lg font-semibold\">Select a Parking Slot</h2>\r\n          <Button \r\n            size=\"sm\" \r\n            variant=\"outline\" \r\n            leftIcon={<ArrowPathIcon className=\"h-4 w-4\" />}\r\n            onClick={refreshParkingData}\r\n          >\r\n            Refresh\r\n          </Button>\r\n        </div>\r\n        \r\n        {isLoading ? (\r\n          <div className=\"flex justify-center py-8\">\r\n            <Loading />\r\n          </div>\r\n        ) : (\r\n          <>\r\n            {/* Parking slot grid */}\r\n            <div className=\"grid grid-cols-5 md:grid-cols-10 gap-1 mb-6 bg-yellow-50 p-3 rounded-lg\">\r\n              {parkingSlots.map((slot) => (\r\n                <div\r\n                  key={slot.id}\r\n                  className={`\r\n                    h-10 rounded flex items-center justify-center text-sm font-medium \r\n                    ${slot.status === 'available' \r\n                      ? selectedSlot && selectedSlot.id === slot.id\r\n                        ? 'bg-yellow-200 text-black cursor-pointer'\r\n                        : 'bg-white border border-gray-300 hover:bg-yellow-100 cursor-pointer'\r\n                      : 'bg-black text-white cursor-not-allowed'\r\n                    }\r\n                  `}\r\n                  onClick={() => handleSlotSelect(slot)}\r\n                >\r\n                  {slot.number}\r\n                </div>\r\n              ))}\r\n            </div>\r\n            \r\n            {/* Selected slot info and book button */}\r\n            <div className=\"flex justify-between items-center\">\r\n              <div>\r\n                {selectedSlot ? (\r\n                  <p className=\"font-medium\">\r\n                    Selected Slot: <span className=\"text-yellow-600\">{selectedSlot.number}</span>\r\n                  </p>\r\n                ) : (\r\n                  <p className=\"text-neutral-600 dark:text-neutral-400\">No slot selected</p>\r\n                )}\r\n              </div>\r\n              <Button \r\n                variant=\"primary\"\r\n                disabled={!selectedSlot}\r\n                onClick={handleBookClick}\r\n                className=\"bg-yellow-400 hover:bg-yellow-500 border-yellow-500 text-black flex items-center\"\r\n              >\r\n                {!isAuthenticated() && <ShieldCheckIcon className=\"h-4 w-4 mr-1\" />}\r\n                {isAuthenticated() ? \"Book Selected Slot\" : \"Login & Book Selected Slot\"}\r\n              </Button>\r\n            </div>\r\n          </>\r\n        )}\r\n      </div>\r\n\r\n      {/* Booking Confirmation Modal */}\r\n      <Modal\r\n        isOpen={isBookingModalOpen}\r\n        onClose={() => {\r\n          setIsBookingModalOpen(false);\r\n          setPauseRefresh(false);\r\n          setBookingComplete(false);\r\n        }}\r\n        title={bookingComplete ? \"Booking Confirmed!\" : \"Confirm Booking\"}\r\n        size=\"md\"\r\n        footer={\r\n          bookingComplete ? (\r\n            <div className=\"flex justify-center gap-4\">\r\n              <Button\r\n                variant=\"outline\"\r\n                onClick={handleCloseConfirmation}\r\n              >\r\n                Back to Parking\r\n              </Button>\r\n              <Button\r\n                variant=\"primary\"\r\n                onClick={downloadTicket}\r\n                className=\"bg-blue-600 hover:bg-blue-700 text-white\"\r\n              >\r\n                Download Ticket\r\n              </Button>\r\n              <Button\r\n                variant=\"primary\"\r\n                onClick={handleGetDirections}\r\n                className=\"bg-yellow-400 hover:bg-yellow-500 text-black\"\r\n              >\r\n                Get Directions\r\n              </Button>\r\n            </div>\r\n          ) : null\r\n        }\r\n      >\r\n        {bookingComplete ? (\r\n          <div className=\"text-center\" ref={ticketRef}>\r\n            <div className=\"mb-4 flex justify-center\">\r\n              <div className=\"h-16 w-16 rounded-full bg-yellow-400 flex items-center justify-center\">\r\n                <CheckCircleIcon className=\"h-10 w-10 text-white\" />\r\n              </div>\r\n            </div>\r\n            <h3 className=\"text-xl font-semibold mb-4\">Your parking has been booked!</h3>\r\n            \r\n            <div className=\"bg-yellow-50 p-4 rounded-lg mb-6 text-left\">\r\n              <div className=\"grid grid-cols-2 gap-y-3\">\r\n                <div className=\"font-medium\">Booking Reference:</div>\r\n                <div className=\"font-bold\">{bookingReference}</div>\r\n                \r\n                <div>Name:</div>\r\n                <div>{bookingForm.name}</div>\r\n                \r\n                <div>Vehicle Number:</div>\r\n                <div>{bookingForm.vehicleNumber}</div>\r\n                \r\n                <div>Vehicle Type:</div>\r\n                <div>{VEHICLE_TYPES.find(v => v.value === bookingForm.vehicleType)?.label}</div>\r\n                \r\n                <div>Parking Spot:</div>\r\n                <div>Slot {selectedSlot?.number}</div>\r\n                \r\n                <div>Duration:</div>\r\n                <div>{DURATION_OPTIONS.find(d => d.value === bookingForm.duration)?.label}</div>\r\n                \r\n                <div>Payment Method:</div>\r\n                <div>{PAYMENT_METHODS.find(p => p.value === bookingForm.paymentMethod)?.label}</div>\r\n                \r\n                <div>Date & Time:</div>\r\n                <div>{new Date().toLocaleString(undefined, { \r\n                  year: 'numeric', \r\n                  month: 'numeric', \r\n                  day: 'numeric',\r\n                  hour: '2-digit',\r\n                  minute: '2-digit',\r\n                  second: '2-digit',\r\n                  hour12: true\r\n                })}</div>\r\n                \r\n                <div>Rate:</div>\r\n                <div>₹{HOURLY_RATE}/hr</div>\r\n                \r\n                <div>Amount:</div>\r\n                <div>₹{calculatePrice(bookingForm.duration)} (₹{HOURLY_RATE}/hr x {bookingForm.duration} {parseInt(bookingForm.duration) === 1 ? 'hour' : 'hours'})</div>\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"text-gray-600 text-sm\">\r\n              A confirmation has been sent to your mobile number: {bookingForm.mobileNumber}\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <div>\r\n            {isLoading ? (\r\n              <div className=\"flex flex-col items-center justify-center py-8\">\r\n                <Loading size=\"lg\" />\r\n                <p className=\"mt-4 text-center\">Processing your booking...</p>\r\n              </div>\r\n            ) : (\r\n              <>\r\n                <div className=\"mb-4\">\r\n                  <p>You are about to book:</p>\r\n                  <div className=\"flex justify-between mt-2 p-3 bg-yellow-50 rounded-lg\">\r\n                    <div>\r\n                      <p className=\"font-medium\">{parkingDetails?.name}</p>\r\n                      <p className=\"text-sm text-gray-600\">Slot: {selectedSlot?.number}</p>\r\n                    </div>\r\n                    <div className=\"text-right\">\r\n                      <p className=\"font-bold\">₹{calculatePrice(bookingForm.duration)}</p>\r\n                      <p className=\"text-sm text-gray-600\">\r\n                        {bookingForm.duration} {parseInt(bookingForm.duration) === 1 ? 'hour' : 'hours'}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                \r\n                {/* Customer Information Form */}\r\n                <div className=\"mb-4\">\r\n                  <h4 className=\"font-medium mb-2\">Customer Information</h4>\r\n                  <div className=\"space-y-3\">\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium mb-1\">Full Name <span className=\"text-red-500\">*</span></label>\r\n                      <input \r\n                        type=\"text\"\r\n                        name=\"name\"\r\n                        value={bookingForm.name}\r\n                        onChange={handleInputChange}\r\n                        placeholder=\"Enter your full name\"\r\n                        className=\"w-full p-2 border border-gray-300 rounded-md\"\r\n                        required\r\n                      />\r\n                    </div>\r\n                    \r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                      <div>\r\n                        <label className=\"block text-sm font-medium mb-1\">Vehicle Number <span className=\"text-red-500\">*</span></label>\r\n                        <input \r\n                          type=\"text\"\r\n                          name=\"vehicleNumber\"\r\n                          value={bookingForm.vehicleNumber}\r\n                          onChange={handleInputChange}\r\n                          placeholder=\"e.g. MH02AB1234\"\r\n                          className=\"w-full p-2 border border-gray-300 rounded-md\"\r\n                          required\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <label className=\"block text-sm font-medium mb-1\">Vehicle Type</label>\r\n                        <select\r\n                          name=\"vehicleType\"\r\n                          value={bookingForm.vehicleType}\r\n                          onChange={handleInputChange}\r\n                          className=\"w-full p-2 border border-gray-300 rounded-md\"\r\n                        >\r\n                          {VEHICLE_TYPES.map(type => (\r\n                            <option key={type.value} value={type.value}>{type.label}</option>\r\n                          ))}\r\n                        </select>\r\n                      </div>\r\n                    </div>\r\n                    \r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                      <div>\r\n                        <label className=\"block text-sm font-medium mb-1\">Mobile Number <span className=\"text-red-500\">*</span></label>\r\n                        <input \r\n                          type=\"tel\"\r\n                          name=\"mobileNumber\"\r\n                          value={bookingForm.mobileNumber}\r\n                          onChange={handleInputChange}\r\n                          placeholder=\"10 digits mobile number\"\r\n                          className=\"w-full p-2 border border-gray-300 rounded-md\"\r\n                          maxLength={10}\r\n                          required\r\n                          pattern=\"[0-9]{10}\"\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <label className=\"block text-sm font-medium mb-1\">Duration</label>\r\n                        <select\r\n                          name=\"duration\"\r\n                          value={bookingForm.duration}\r\n                          onChange={handleInputChange}\r\n                          className=\"w-full p-2 border border-gray-300 rounded-md\"\r\n                        >\r\n                          {DURATION_OPTIONS.map(option => (\r\n                            <option key={option.value} value={option.value}>{option.label} - ₹{calculatePrice(option.value)}</option>\r\n                          ))}\r\n                        </select>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                \r\n                {/* Payment Method Selection */}\r\n                <div className=\"mb-4\">\r\n                  <h4 className=\"font-medium mb-2\">Payment Method</h4>\r\n                  <div className=\"space-y-2\">\r\n                    {PAYMENT_METHODS.map(method => (\r\n                      <label key={method.value} className=\"flex items-center p-3 border rounded-md hover:bg-gray-50 cursor-pointer\">\r\n                        <input \r\n                          type=\"radio\"\r\n                          name=\"paymentMethod\"\r\n                          value={method.value}\r\n                          checked={bookingForm.paymentMethod === method.value}\r\n                          onChange={handleInputChange}\r\n                          className=\"mr-2\"\r\n                        />\r\n                        <span>{method.label}</span>\r\n                      </label>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n                \r\n                {/* Payment details based on selected method */}\r\n                {bookingForm.paymentMethod === 'card' && (\r\n                  <div className=\"mb-4 border-t pt-4\">\r\n                    <h4 className=\"font-medium mb-2\">Card Information</h4>\r\n                    <div className=\"space-y-3\">\r\n                      <div>\r\n                        <label className=\"block text-sm font-medium mb-1\">Card Number</label>\r\n                        <input\r\n                          type=\"text\"\r\n                          name=\"cardNumber\"\r\n                          value={cardForm.cardNumber}\r\n                          onChange={handleCardInputChange}\r\n                          placeholder=\"1234 5678 9012 3456\"\r\n                          className=\"w-full p-2 border border-gray-300 rounded-md\"\r\n                        />\r\n                      </div>\r\n                      <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div>\r\n                          <label className=\"block text-sm font-medium mb-1\">Expiry Date</label>\r\n                          <input\r\n                            type=\"text\"\r\n                            name=\"expiryDate\"\r\n                            value={cardForm.expiryDate}\r\n                            onChange={handleCardInputChange}\r\n                            placeholder=\"MM/YY\"\r\n                            className=\"w-full p-2 border border-gray-300 rounded-md\"\r\n                          />\r\n                        </div>\r\n                        <div>\r\n                          <label className=\"block text-sm font-medium mb-1\">CVV</label>\r\n                          <input\r\n                            type=\"text\"\r\n                            name=\"cvv\"\r\n                            value={cardForm.cvv}\r\n                            onChange={handleCardInputChange}\r\n                            placeholder=\"123\"\r\n                            className=\"w-full p-2 border border-gray-300 rounded-md\"\r\n                            maxLength={3}\r\n                          />\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n                \r\n                {bookingForm.paymentMethod === 'upi' && (\r\n                  <div className=\"mb-4 border-t pt-4\">\r\n                    <h4 className=\"font-medium mb-2\">UPI Payment</h4>\r\n                    <p className=\"text-sm text-gray-600 mb-2\">You'll receive a payment request on your UPI app after confirmation.</p>\r\n                    <div className=\"flex items-center justify-center space-x-4 my-4\">\r\n                      <img src=\"/images/upi-icons/gpay.png\" alt=\"Google Pay\" className=\"h-8\" />\r\n                      <img src=\"/images/upi-icons/phonepe.png\" alt=\"PhonePe\" className=\"h-8\" />\r\n                      <img src=\"/images/upi-icons/paytm.png\" alt=\"Paytm\" className=\"h-8\" />\r\n                      <img src=\"/images/upi-icons/bhim.png\" alt=\"BHIM\" className=\"h-8\" />\r\n                    </div>\r\n                  </div>\r\n                )}\r\n                \r\n                <div className=\"flex justify-end mt-6\">\r\n                  <Button\r\n                    variant=\"outline\"\r\n                    onClick={() => {\r\n                      setIsBookingModalOpen(false);\r\n                      setPauseRefresh(false);\r\n                    }}\r\n                    className=\"mr-2\"\r\n                  >\r\n                    Cancel\r\n                  </Button>\r\n                  <Button\r\n                    variant=\"primary\"\r\n                    onClick={handleBooking}\r\n                    className=\"bg-yellow-400 hover:bg-yellow-500 text-black\"\r\n                  >\r\n                    Confirm Booking\r\n                  </Button>\r\n                </div>\r\n              </>\r\n            )}\r\n          </div>\r\n        )}\r\n      </Modal>\r\n      \r\n      {/* Login Modal */}\r\n      <LoginModal \r\n        isOpen={isLoginModalOpen} \r\n        onClose={() => {\r\n          setIsLoginModalOpen(false);\r\n          setPauseRefresh(false);\r\n          \r\n          // If user is authenticated and has a slot selected, open booking modal\r\n          if (isAuthenticated() && selectedSlot) {\r\n            setIsBookingModalOpen(true);\r\n          }\r\n        }}\r\n        onSignupClick={handleSignupClick}\r\n      />\r\n      \r\n      {/* Signup Modal */}\r\n      <SignupModal\r\n        isOpen={isSignupModalOpen}\r\n        onClose={() => {\r\n          setIsSignupModalOpen(false);\r\n          setPauseRefresh(false);\r\n        }}\r\n        onLoginClick={() => {\r\n          setIsSignupModalOpen(false);\r\n          setIsLoginModalOpen(true);\r\n        }}\r\n      />\r\n      \r\n      {/* Mobile navigation dots */}\r\n      <div className=\"flex justify-center space-x-2 mt-8\">\r\n        <div className=\"w-2 h-2 rounded-full bg-gray-300\"></div>\r\n        <div className=\"w-2 h-2 rounded-full bg-yellow-400\"></div>\r\n        <div className=\"w-2 h-2 rounded-full bg-gray-300\"></div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ParkingSlotPage; "],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,CAAEC,MAAM,KAAQ,OAAO,CAC1D,OAASC,SAAS,CAAEC,WAAW,CAAEC,WAAW,KAAQ,kBAAkB,CACtE,OAASC,OAAO,CAAEC,SAAS,CAAEC,iBAAiB,CAAEC,aAAa,CAAEC,UAAU,CAAEC,eAAe,CAAEC,OAAO,CAAEC,eAAe,CAAEC,yBAAyB,CAAEC,eAAe,KAAQ,6BAA6B,CACrM,OAASC,IAAI,CAAEC,MAAM,CAAEC,KAAK,CAAEC,MAAM,CAAEC,KAAK,CAAEC,OAAO,CAAEC,KAAK,CAAEC,KAAK,KAAQ,sBAAsB,CAChG,OAASC,KAAK,KAAQ,gBAAgB,CACtC,OAASC,OAAO,KAAQ,wBAAwB,CAChD,OAASC,UAAU,CAAEC,WAAW,KAAQ,oBAAoB,CAC5D,MAAO,CAAAC,WAAW,KAAM,aAAa,CACrC,MAAO,CAAAC,KAAK,KAAM,OAAO,CACzB,OAASC,MAAM,KAAQ,UAAU,CAEjC;AAAA,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,CAAAC,QAAA,IAAAC,SAAA,yBACA,KAAM,CAAAC,YAAY,CAAG,MAAM,CAAE;AAE7B;AACA,KAAM,CAAAC,WAAW,CAAG,EAAE,CAAE;AACxB,KAAM,CAAAC,gBAAgB,CAAG,KAAK,CAAE;AAEhC;AACA,KAAM,CAAAC,gBAAgB,CAAG,CACvB,CAAEC,KAAK,CAAE,GAAG,CAAEC,KAAK,CAAE,QAAQ,CAAEC,KAAK,CAAE,CAAE,CAAC,CACzC,CAAEF,KAAK,CAAE,GAAG,CAAEC,KAAK,CAAE,SAAS,CAAEC,KAAK,CAAE,CAAE,CAAC,CAC1C,CAAEF,KAAK,CAAE,GAAG,CAAEC,KAAK,CAAE,SAAS,CAAEC,KAAK,CAAE,CAAE,CAAC,CAC1C,CAAEF,KAAK,CAAE,GAAG,CAAEC,KAAK,CAAE,SAAS,CAAEC,KAAK,CAAE,CAAE,CAAC,CAC1C,CAAEF,KAAK,CAAE,IAAI,CAAEC,KAAK,CAAE,qBAAqB,CAAEC,KAAK,CAAE,EAAG,CAAC,CACzD,CAED;AACA,KAAM,CAAAC,aAAa,CAAG,CACpB,CAAEH,KAAK,CAAE,KAAK,CAAEC,KAAK,CAAE,KAAM,CAAC,CAC9B,CAAED,KAAK,CAAE,MAAM,CAAEC,KAAK,CAAE,cAAe,CAAC,CACxC,CAAED,KAAK,CAAE,KAAK,CAAEC,KAAK,CAAE,KAAM,CAAC,CAC9B,CAAED,KAAK,CAAE,OAAO,CAAEC,KAAK,CAAE,WAAY,CAAC,CACvC,CAED;AACA,KAAM,CAAAG,eAAe,CAAG,CACtB,CAAEJ,KAAK,CAAE,KAAK,CAAEC,KAAK,CAAE,KAAM,CAAC,CAC9B,CAAED,KAAK,CAAE,MAAM,CAAEC,KAAK,CAAE,mBAAoB,CAAC,CAC7C,CAAED,KAAK,CAAE,MAAM,CAAEC,KAAK,CAAE,MAAO,CAAC,CACjC,CAED;AACA,KAAM,CAAAI,YAAY,CAAG,CACnBC,IAAI,CAAE,qBAAqB,CAC3BC,OAAO,CAAE,6BACX,CAAC,CAED,KAAM,CAAAC,eAAe,CAAGA,CAAA,GAAM,KAAAC,eAAA,CAAAC,oBAAA,CAAAC,qBAAA,CAAAC,qBAAA,CAC5B,KAAM,CAAEC,SAAU,CAAC,CAAGnD,SAAS,CAAC,CAAC,CACjC,KAAM,CAAAoD,QAAQ,CAAGnD,WAAW,CAAC,CAAC,CAC9B,KAAM,CAAAoD,QAAQ,CAAGnD,WAAW,CAAC,CAAC,CAC9B,KAAM,CAAEoD,eAAe,CAAEC,IAAK,CAAC,CAAGjC,OAAO,CAAC,CAAC,CAE3C;AACA,KAAM,CAAAkC,oBAAoB,EAAAT,eAAA,CAAGM,QAAQ,CAACI,KAAK,UAAAV,eAAA,iBAAdA,eAAA,CAAgBW,cAAc,CAE3D,KAAM,CAACC,SAAS,CAAEC,YAAY,CAAC,CAAG/D,QAAQ,CAAC,IAAI,CAAC,CAChD,KAAM,CAAC6D,cAAc,CAAEG,iBAAiB,CAAC,CAAGhE,QAAQ,CAAC,IAAI,CAAC,CAC1D,KAAM,CAACiE,YAAY,CAAEC,eAAe,CAAC,CAAGlE,QAAQ,CAAC,EAAE,CAAC,CACpD,KAAM,CAACmE,YAAY,CAAEC,eAAe,CAAC,CAAGpE,QAAQ,CAAC,IAAI,CAAC,CACtD,KAAM,CAACqE,kBAAkB,CAAEC,qBAAqB,CAAC,CAAGtE,QAAQ,CAAC,KAAK,CAAC,CACnE,KAAM,CAACuE,gBAAgB,CAAEC,mBAAmB,CAAC,CAAGxE,QAAQ,CAAC,KAAK,CAAC,CAC/D,KAAM,CAACyE,iBAAiB,CAAEC,oBAAoB,CAAC,CAAG1E,QAAQ,CAAC,KAAK,CAAC,CACjE,KAAM,CAAC2E,cAAc,CAAEC,iBAAiB,CAAC,CAAG5E,QAAQ,CAAC,KAAK,CAAC,CAC3D,KAAM,CAAC6E,SAAS,CAAEC,YAAY,CAAC,CAAG9E,QAAQ,CAAC,IAAI,CAAC,CAChD,KAAM,CAAC+E,SAAS,CAAEC,YAAY,CAAC,CAAGhF,QAAQ,CAAC,KAAK,CAAC,CACjD,KAAM,CAACiF,YAAY,CAAEC,eAAe,CAAC,CAAGlF,QAAQ,CAAC,KAAK,CAAC,CACvD,KAAM,CAACmF,eAAe,CAAEC,kBAAkB,CAAC,CAAGpF,QAAQ,CAAC,IAAI,CAAC,CAC5D,KAAM,CAACqF,WAAW,CAAEC,cAAc,CAAC,CAAGtF,QAAQ,CAAC,MAAM,CAAC,CACtD,KAAM,CAACuF,YAAY,CAAEC,eAAe,CAAC,CAAGxF,QAAQ,CAAC,EAAE,CAAC,CACpD,KAAM,CAACyF,SAAS,CAAEC,YAAY,CAAC,CAAG1F,QAAQ,CAAC,KAAK,CAAC,CACjD,KAAM,CAAC2F,cAAc,CAAEC,iBAAiB,CAAC,CAAG5F,QAAQ,CAAC,MAAM,CAAC,CAC5D,KAAM,CAAC6F,QAAQ,CAAEC,WAAW,CAAC,CAAG9F,QAAQ,CAAC,WAAW,CAAC,CAAE;AAEvD;AACA,KAAM,CAAC+F,WAAW,CAAEC,cAAc,CAAC,CAAGhG,QAAQ,CAAC,CAC7CiG,IAAI,CAAE,EAAE,CACRC,aAAa,CAAE,EAAE,CACjBC,WAAW,CAAE,KAAK,CAClBC,YAAY,CAAE,EAAE,CAChBC,aAAa,CAAE,KAAK,CACpBC,QAAQ,CAAE,GAAG,CACbC,WAAW,CAAEjE,WAAY;AAC3B,CAAC,CAAC,CACF,KAAM,CAACkE,eAAe,CAAEC,kBAAkB,CAAC,CAAGzG,QAAQ,CAAC,KAAK,CAAC,CAC7D,KAAM,CAAC0G,gBAAgB,CAAEC,mBAAmB,CAAC,CAAG3G,QAAQ,CAAC,IAAI,CAAC,CAE9D;AACA,KAAM,CAAC4G,QAAQ,CAAEC,WAAW,CAAC,CAAG7G,QAAQ,CAAC,CACvC8G,UAAU,CAAE,EAAE,CACdC,UAAU,CAAE,EAAE,CACdC,GAAG,CAAE,EAAE,CACPC,QAAQ,CAAE,EACZ,CAAC,CAAC,CAEF;AACA,KAAM,CAAAC,SAAS,CAAGhH,MAAM,CAAC,IAAI,CAAC,CAE9B;AACA,KAAM,CAAAiH,cAAc,CAAG,KAAAA,CAAA,GAAY,CACjC,GAAI,CACF;AACA,KAAM,CAAAC,QAAQ,CAAG,KAAM,CAAAC,KAAK,CAAC,GAAGC,MAAM,CAAC9D,QAAQ,CAAC+D,QAAQ,KAAKD,MAAM,CAAC9D,QAAQ,CAACgE,QAAQ,gCAAgC,CAAE,CACrHC,MAAM,CAAE,KACV,CAAC,CAAC,CAEF,GAAIL,QAAQ,CAACM,EAAE,CAAE,CACf,KAAM,CAAAC,IAAI,CAAG,KAAM,CAAAP,QAAQ,CAACQ,IAAI,CAAC,CAAC,CAClCtC,cAAc,CAACqC,IAAI,CAACE,cAAc,CAAC,CACnCnC,YAAY,CAACiC,IAAI,CAACG,UAAU,CAAC,CAC7BlC,iBAAiB,CAAC+B,IAAI,CAACI,eAAe,CAAC,CACvCC,OAAO,CAACC,GAAG,CAAC,eAAe,CAAEN,IAAI,CAAC,CAElC;AACAO,kBAAkB,CAACP,IAAI,CAACE,cAAc,CAAC,CAEvC;AACAM,iBAAiB,CAAC,CAAC,CAEnBvD,iBAAiB,CAAC,IAAI,CAAC,CACzB,CAAC,IAAM,CACL,KAAM,IAAI,CAAAwD,KAAK,CAAC,yBAAyB,CAAC,CAC5C,CACF,CAAE,MAAOC,KAAK,CAAE,CACdL,OAAO,CAACK,KAAK,CAAC,8BAA8B,CAAEA,KAAK,CAAC,CACpD;AACAvD,YAAY,CAAChC,YAAY,CAACuC,WAAW,EAAI,MAAM,CAAC,CAAC,CACjDT,iBAAiB,CAAC,KAAK,CAAC,CACxBpD,KAAK,CAAC8G,IAAI,CAAC,oDAAoD,CAAC,CAClE,CACF,CAAC,CAED,KAAM,CAAAH,iBAAiB,CAAG,KAAAA,CAAA,GAAY,CACpC,GAAI,CACF,KAAM,CAAAf,QAAQ,CAAG,KAAM,CAAAC,KAAK,CAAC,GAAGC,MAAM,CAAC9D,QAAQ,CAAC+D,QAAQ,KAAKD,MAAM,CAAC9D,QAAQ,CAACgE,QAAQ,iCAAiC,CAAC,CACvH,GAAIJ,QAAQ,CAACM,EAAE,CAAE,CACf,KAAM,CAAAC,IAAI,CAAG,KAAM,CAAAP,QAAQ,CAACQ,IAAI,CAAC,CAAC,CAClCpC,eAAe,CAACmC,IAAI,CAACY,SAAS,CAAC,CAC/BjD,cAAc,CAACqC,IAAI,CAACa,OAAO,CAAC,CAC9B,CACF,CAAE,MAAOH,KAAK,CAAE,CACdL,OAAO,CAACK,KAAK,CAAC,+BAA+B,CAAEA,KAAK,CAAC,CACvD,CACF,CAAC,CAED,KAAM,CAAAH,kBAAkB,CAAIO,MAAM,EAAK,CACrC,KAAM,CAAAC,OAAO,CAAG,GAAGpB,MAAM,CAAC9D,QAAQ,CAAC+D,QAAQ,KAAKD,MAAM,CAAC9D,QAAQ,CAACgE,QAAQ,mBAAmB,CAE3F;AACA,GAAI,CAAAmB,GAAG,CACP,OAAQ9C,QAAQ,EACd,IAAK,KAAK,CACR8C,GAAG,CAAG,GAAGD,OAAO,YAAY,CAC5B,MACF,IAAK,WAAW,CACdC,GAAG,CAAG,GAAGD,OAAO,kBAAkB,CAClC,MACF,IAAK,WAAW,CACdC,GAAG,CAAG,GAAGD,OAAO,kBAAkB,CAClC,MACF,IAAK,WAAW,CAChB,QACEC,GAAG,CAAG,GAAGD,OAAO,QAAQ,CAC5B,CAEA5D,YAAY,CAAC6D,GAAG,CAAC,CACjBX,OAAO,CAACC,GAAG,CAAC,wBAAwB,CAAEU,GAAG,CAAC,CAC5C,CAAC,CAED,KAAM,CAAAC,iBAAiB,CAAG,KAAO,CAAAH,MAAM,EAAK,CAC1C,GAAI,CACF,GAAI9D,cAAc,CAAE,CAClB,KAAM,CAAAyC,QAAQ,CAAG,KAAM,CAAAC,KAAK,CAAC,GAAGC,MAAM,CAAC9D,QAAQ,CAAC+D,QAAQ,KAAKD,MAAM,CAAC9D,QAAQ,CAACgE,QAAQ,gCAAgC,CAAE,CACrHC,MAAM,CAAE,MAAM,CACdoB,OAAO,CAAE,CACP,cAAc,CAAE,kBAClB,CAAC,CACDC,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CAAEP,MAAO,CAAC,CACjC,CAAC,CAAC,CAEF,GAAIrB,QAAQ,CAACM,EAAE,CAAE,CACf,KAAM,CAAAC,IAAI,CAAG,KAAM,CAAAP,QAAQ,CAACQ,IAAI,CAAC,CAAC,CAClCtC,cAAc,CAACqC,IAAI,CAACE,cAAc,CAAC,CACnCrG,KAAK,CAACyH,OAAO,CAAC,2BAA2BR,MAAM,EAAE,CAAC,CAClD;AACAP,kBAAkB,CAACO,MAAM,CAAC,CAC5B,CAAC,IAAM,CACL,KAAM,IAAI,CAAAL,KAAK,CAAC,+BAA+B,CAAC,CAClD,CACF,CAAC,IAAM,CACL;AACA9C,cAAc,CAACmD,MAAM,CAAC,CACtB3D,YAAY,CAAChC,YAAY,CAAC2F,MAAM,CAAC,CAAC,CAClCjH,KAAK,CAAC8G,IAAI,CAAC,2BAA2BG,MAAM,eAAe,CAAC,CAC9D,CACF,CAAE,MAAOJ,KAAK,CAAE,CACdL,OAAO,CAACK,KAAK,CAAC,8BAA8B,CAAEA,KAAK,CAAC,CACpD;AACA/C,cAAc,CAACmD,MAAM,CAAC,CACtB3D,YAAY,CAAChC,YAAY,CAAC2F,MAAM,CAAC,CAAC,CAClCjH,KAAK,CAAC8G,IAAI,CAAC,2BAA2BG,MAAM,eAAe,CAAC,CAC9D,CACF,CAAC,CAED,KAAM,CAAAS,eAAe,CAAG,KAAAA,CAAA,GAAY,CAClC,GAAI,CACF,KAAM,CAAAC,YAAY,CAAG,CAAC1D,SAAS,CAC/B,KAAM,CAAA2B,QAAQ,CAAG,KAAM,CAAAC,KAAK,CAAC,GAAGC,MAAM,CAAC9D,QAAQ,CAAC+D,QAAQ,KAAKD,MAAM,CAAC9D,QAAQ,CAACgE,QAAQ,+BAA+B,CAAE,CACpHC,MAAM,CAAE,MAAM,CACdoB,OAAO,CAAE,CACP,cAAc,CAAE,kBAClB,CAAC,CACDC,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CAAEI,OAAO,CAAED,YAAa,CAAC,CAChD,CAAC,CAAC,CAEF,GAAI/B,QAAQ,CAACM,EAAE,CAAE,CACfhC,YAAY,CAACyD,YAAY,CAAC,CAC1B3H,KAAK,CAACyH,OAAO,CAAC,cAAcE,YAAY,CAAG,SAAS,CAAG,UAAU,EAAE,CAAC,CACtE,CAAC,IAAM,CACL,KAAM,IAAI,CAAAf,KAAK,CAAC,6BAA6B,CAAC,CAChD,CACF,CAAE,MAAOC,KAAK,CAAE,CACdL,OAAO,CAACK,KAAK,CAAC,4BAA4B,CAAEA,KAAK,CAAC,CAClD7G,KAAK,CAAC6G,KAAK,CAAC,6BAA6B,CAAC,CAC5C,CACF,CAAC,CAED,KAAM,CAAAgB,sBAAsB,CAAG,KAAO,CAAAC,IAAI,EAAK,CAC7C,GAAI,CACF,KAAM,CAAAlC,QAAQ,CAAG,KAAM,CAAAC,KAAK,CAAC,GAAGC,MAAM,CAAC9D,QAAQ,CAAC+D,QAAQ,KAAKD,MAAM,CAAC9D,QAAQ,CAACgE,QAAQ,8BAA8B,CAAE,CACnHC,MAAM,CAAE,MAAM,CACdoB,OAAO,CAAE,CACP,cAAc,CAAE,kBAClB,CAAC,CACDC,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CAAEM,IAAK,CAAC,CAC/B,CAAC,CAAC,CAEF,GAAIlC,QAAQ,CAACM,EAAE,CAAE,CACf9B,iBAAiB,CAAC0D,IAAI,CAAC,CACvB9H,KAAK,CAACyH,OAAO,CAAC,0BAA0BK,IAAI,EAAE,CAAC,CACjD,CAAC,IAAM,CACL,KAAM,IAAI,CAAAlB,KAAK,CAAC,kCAAkC,CAAC,CACrD,CACF,CAAE,MAAOC,KAAK,CAAE,CACdL,OAAO,CAACK,KAAK,CAAC,iCAAiC,CAAEA,KAAK,CAAC,CACvD7G,KAAK,CAAC6G,KAAK,CAAC,kCAAkC,CAAC,CACjD,CACF,CAAC,CAED,KAAM,CAAAkB,cAAc,CAAID,IAAI,EAAK,CAC/BxD,WAAW,CAACwD,IAAI,CAAC,CACjBpB,kBAAkB,CAAC7C,WAAW,CAAC,CAC/B7D,KAAK,CAAC8G,IAAI,CAAC,mBAAmBgB,IAAI,EAAE,CAAC,CACvC,CAAC,CAED;AACA,KAAM,CAAAE,iBAAiB,CAAGA,CAACC,KAAK,CAAElB,SAAS,GAAK,CAC9C,KAAM,CAAAmB,KAAK,CAAG,EAAE,CAChB,KAAM,CAAAC,cAAc,CAAG,EAAE,CAEzB;AACA,MAAOA,cAAc,CAACC,MAAM,CAAGrB,SAAS,CAAE,CACxC,KAAM,CAAAsB,UAAU,CAAGC,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,MAAM,CAAC,CAAC,CAAGP,KAAK,CAAC,CAAG,CAAC,CACxD,GAAI,CAACE,cAAc,CAACM,QAAQ,CAACJ,UAAU,CAAC,CAAE,CACxCF,cAAc,CAACO,IAAI,CAACL,UAAU,CAAC,CACjC,CACF,CAEA;AACA,IAAK,GAAI,CAAAM,CAAC,CAAG,CAAC,CAAEA,CAAC,EAAIV,KAAK,CAAEU,CAAC,EAAE,CAAE,CAC/BT,KAAK,CAACQ,IAAI,CAAC,CACTE,EAAE,CAAED,CAAC,CACLE,MAAM,CAAEF,CAAC,CACTG,MAAM,CAAEX,cAAc,CAACM,QAAQ,CAACE,CAAC,CAAC,CAAG,WAAW,CAAG,UAAU,CAC7DI,IAAI,CAAEJ,CAAC,CAAG,CAAC,GAAK,CAAC,CAAG,aAAa,CAAGA,CAAC,CAAG,CAAC,GAAK,CAAC,CAAG,UAAU,CAAG,UACjE,CAAC,CAAC,CACJ,CAEA,MAAO,CAAAT,KAAK,CACd,CAAC,CAED;AACA,KAAM,CAAAc,oBAAoB,CAAGA,CAACf,KAAK,CAAElB,SAAS,GAAK,CACjD,KAAM,CAAAmB,KAAK,CAAGF,iBAAiB,CAACC,KAAK,CAAElB,SAAS,CAAC,CACjDrE,eAAe,CAACwF,KAAK,CAAC,CACtB,MAAO,CAAAA,KAAK,CACd,CAAC,CAEDzJ,SAAS,CAAC,IAAM,CACd;AACA,GAAI0D,oBAAoB,CAAE,CACxB;AACAK,iBAAiB,CAAC,CAChBoG,EAAE,CAAEzG,oBAAoB,CAACyG,EAAE,CAC3BnE,IAAI,CAAEtC,oBAAoB,CAACsC,IAAI,CAC/BwE,OAAO,CAAE9G,oBAAoB,CAAC8G,OAAO,CACrCC,WAAW,CAAE/G,oBAAoB,CAAC+G,WAAW,CAC7C/H,KAAK,CAAEgB,oBAAoB,CAAChB,KAAK,CACjCgI,aAAa,CAAEhH,oBAAoB,CAAChB,KAAK,CACzCiI,KAAK,CAAE,CACLC,MAAM,CAAElH,oBAAoB,CAACmH,UAAU,CACvCC,KAAK,CAAE,IAAIC,QAAQ,CAACrH,oBAAoB,CAACmH,UAAU,CAACG,OAAO,CAAC,GAAG,CAAE,EAAE,CAAC,CAACA,OAAO,CAAC,KAAK,CAAE,EAAE,CAAC,CAAC,CAAG,CAAC,MAC9F,CAAC,CACDC,QAAQ,CAAEvH,oBAAoB,CAACuH,QAAQ,CAAGvH,oBAAoB,CAACuH,QAAQ,CAACC,KAAK,CAAC,IAAI,CAAC,CAAG,EAAE,CACxFC,UAAU,CAAE,EAAE,CAAE;AAChBzB,cAAc,CAAEhG,oBAAoB,CAAC4E,SAAS,CAC9CgC,IAAI,CAAE5G,oBAAoB,CAAC4G,IAC7B,CAAC,CAAC,CAEF;AACAC,oBAAoB,CAAC,EAAE,CAAE7G,oBAAoB,CAAC4E,SAAS,CAAC,CAExDxE,YAAY,CAAC,KAAK,CAAC,CACrB,CAAC,IAAM,CACL;AACAsH,mBAAmB,CAAC,CAAC,CACvB,CAEA;AACAlE,cAAc,CAAC,CAAC,CAEhB;AACA,KAAM,CAAAmE,UAAU,CAAGC,WAAW,CAAC,IAAM,CACnC;AACA,GAAI,CAACtG,YAAY,EAAI,CAACtB,oBAAoB,CAAE,CAC1C6H,aAAa,CAAC,CAAC,CACfpG,kBAAkB,CAAC,GAAI,CAAAqG,IAAI,CAAC,CAAC,CAACC,kBAAkB,CAAC,CAAC,CAAC,CACrD,CACF,CAAC,CAAEnJ,gBAAgB,CAAC,CAEpB;AACA,MAAO,IAAMoJ,aAAa,CAACL,UAAU,CAAC,CACxC,CAAC,CAAE,CAAChI,SAAS,CAAEK,oBAAoB,CAAEsB,YAAY,CAAC,CAAC,CAEnD;AACAhF,SAAS,CAAC,IAAM,CACd,GAAI4E,SAAS,CAAE,CACbqD,kBAAkB,CAAC7C,WAAW,CAAC,CACjC,CACF,CAAC,CAAE,CAACQ,QAAQ,CAAC,CAAC,CAEd;AACA5F,SAAS,CAAC,IAAM,CACdiF,eAAe,CAACb,kBAAkB,CAAC,CACrC,CAAC,CAAE,CAACA,kBAAkB,CAAC,CAAC,CAExB;AACApE,SAAS,CAAC,IAAM,CACd,KAAM,CAAA2L,aAAa,CAAIC,CAAC,EAAK,CAC3B;AACA,GAAI,CAAC9G,SAAS,CAAE,OAEhB;AACA,GAAI8G,CAAC,CAACC,GAAG,CAACC,WAAW,CAAC,CAAC,GAAK,GAAG,CAAE,CAC/B7C,eAAe,CAAC,CAAC,CACnB,CACF,CAAC,CAED5B,MAAM,CAAC0E,gBAAgB,CAAC,SAAS,CAAEJ,aAAa,CAAC,CAEjD;AACA,MAAO,IAAM,CACXtE,MAAM,CAAC2E,mBAAmB,CAAC,SAAS,CAAEL,aAAa,CAAC,CACtD,CAAC,CACH,CAAC,CAAE,CAAC7G,SAAS,CAAEU,SAAS,CAAC,CAAC,CAE1B;AACA,KAAM,CAAAyG,WAAW,CAAIC,QAAQ,EAAK,CAChCjI,eAAe,CAACkI,SAAS,EAAI,CAC3B,MAAO,CAAAA,SAAS,CAACC,GAAG,CAACC,IAAI,EAAI,CAC3B,KAAM,CAAAC,WAAW,CAAGJ,QAAQ,CAACK,IAAI,CAACC,CAAC,EAAIA,CAAC,CAACrC,EAAE,GAAKkC,IAAI,CAAClC,EAAE,CAAC,CACxD,MAAO,CAAAmC,WAAW,EAAID,IAAI,CAC5B,CAAC,CAAC,CACJ,CAAC,CAAC,CACJ,CAAC,CAED,KAAM,CAAAI,gBAAgB,CAAIJ,IAAI,EAAK,CACjC;AACA,GAAIA,IAAI,CAAChC,MAAM,GAAK,UAAU,CAAE,OAEhC;AACA,GAAInG,YAAY,EAAIA,YAAY,CAACiG,EAAE,GAAKkC,IAAI,CAAClC,EAAE,CAAE,CAC/ChG,eAAe,CAAC,IAAI,CAAC,CACvB,CAAC,IAAM,CACLA,eAAe,CAACkI,IAAI,CAAC,CACvB,CACF,CAAC,CAED,KAAM,CAAAd,aAAa,CAAG,KAAAA,CAAA,GAAY,CAChC;AACA,GAAInH,kBAAkB,CAAE,OAExB,GAAI,CACF;AACA,KAAM,CAAA+C,QAAQ,CAAG,KAAM,CAAAC,KAAK,CAAC,GAAGhF,YAAY,kBAAkBwB,cAAc,SAAdA,cAAc,WAAdA,cAAc,CAAEuG,EAAE,CAAG,cAAcvG,cAAc,CAACuG,EAAE,EAAE,CAAG,EAAE,EAAE,CAAC,CAE5H,GAAI,CAAChD,QAAQ,CAACM,EAAE,CAAE,CAChB,KAAM,IAAI,CAAAU,KAAK,CAAC,uBAAuBhB,QAAQ,CAACkD,MAAM,EAAE,CAAC,CAC3D,CAEA,KAAM,CAAA3C,IAAI,CAAG,KAAM,CAAAP,QAAQ,CAACQ,IAAI,CAAC,CAAC,CAElC,GAAID,IAAI,CAAE,CACR/C,iBAAiB,CAAC,IAAI,CAAC,CACvBoD,OAAO,CAACC,GAAG,CAAC,mBAAmB,CAAEN,IAAI,CAAC,CAAE;AAExC;AACA,GAAI9D,cAAc,CAAE,CAClBG,iBAAiB,CAAC2I,IAAI,GAAK,CACzB,GAAGA,IAAI,CACPhD,cAAc,CAAEhC,IAAI,CAACY,SAAS,CAC9B6C,UAAU,CAAEzD,IAAI,CAAC8B,KAAK,EAAI,EAAG;AAC/B,CAAC,CAAC,CAAC,CACL,CAEA;AACA,GAAI9B,IAAI,CAACiF,MAAM,EAAIC,MAAM,CAACC,IAAI,CAACnF,IAAI,CAACiF,MAAM,CAAC,CAAChD,MAAM,CAAG,CAAC,CAAE,CACtD;AACA,KAAM,CAAAmD,QAAQ,CAAGF,MAAM,CAACG,OAAO,CAACrF,IAAI,CAACiF,MAAM,CAAC,CAACP,GAAG,CAACY,IAAA,MAAC,CAAC7C,EAAE,CAAE8C,KAAK,CAAC,CAAAD,IAAA,OAAM,CACjE7C,EAAE,CAAEY,QAAQ,CAACZ,EAAE,CAAC,CAChBC,MAAM,CAAEW,QAAQ,CAACZ,EAAE,CAAC,CAAG,CAAC,CAAE;AAC1BE,MAAM,CAAE4C,KAAK,CAAC5C,MAAM,GAAK,WAAW,CAAG,WAAW,CAAG,UAAU,CAC/DC,IAAI,CAAES,QAAQ,CAACZ,EAAE,CAAC,CAAG,CAAC,GAAK,CAAC,CAAG,SAAS,CAAG,UAC7C,CAAC,EAAC,CAAC,CAEHpC,OAAO,CAACC,GAAG,CAAC,wBAAwB,CAAE8E,QAAQ,CAAC,CAAE;AACjDb,WAAW,CAACa,QAAQ,CAAC,CACvB,CAAC,IAAM,CACL;AACA/E,OAAO,CAACC,GAAG,CAAC,+CAA+C,CAAEN,IAAI,CAAC8B,KAAK,CAAE,YAAY,CAAE9B,IAAI,CAACY,SAAS,CAAC,CACtG,KAAM,CAAA4D,QAAQ,CAAG3C,iBAAiB,CAAC7B,IAAI,CAAC8B,KAAK,EAAI,EAAE,CAAE9B,IAAI,CAACY,SAAS,CAAC,CACpE2D,WAAW,CAACC,QAAQ,CAAC,CACvB,CAEApI,YAAY,CAAC,KAAK,CAAC,CACrB,CACF,CAAE,MAAOsE,KAAK,CAAE,CACdL,OAAO,CAACK,KAAK,CAAC,qDAAqD,CAAEA,KAAK,CAAC,CAE3E;AACA,GAAI,CAAC1D,cAAc,CAAE,CACnBqD,OAAO,CAACC,GAAG,CAAC,2BAA2B,CAAC,CACxC,KAAM,CAAAkF,SAAS,CAAGC,KAAK,CAACC,IAAI,CAAC,CAAEzD,MAAM,CAAE,EAAG,CAAC,CAAE,CAAC0D,CAAC,CAAEC,KAAK,GAAK,CACzD;AACA,KAAM,CAAAC,UAAU,CAAG,CAAC,CAAC,CAAE,CAAC,CAAE,EAAE,CAAE,EAAE,CAAE,EAAE,CAAE,EAAE,CAAE,EAAE,CAAE,EAAE,CAAE,EAAE,CAAE,EAAE,CAAE,EAAE,CAAE,EAAE,CAAE,EAAE,CAAE,EAAE,CAAE,EAAE,CAAE,EAAE,CAAE,EAAE,CAAE,EAAE,CAAE,EAAE,CAAE,EAAE,CAAE,EAAE,CAAC,CAACvD,QAAQ,CAACsD,KAAK,CAAC,CACrH,MAAO,CACLnD,EAAE,CAAEmD,KAAK,CACTlD,MAAM,CAAEkD,KAAK,CAAG,CAAC,CACjBjD,MAAM,CAAEkD,UAAU,CAAG,UAAU,CAAG,WAAW,CAC7CjD,IAAI,CAAEgD,KAAK,CAAG,CAAC,GAAK,CAAC,CAAG,SAAS,CAAG,UACtC,CAAC,CACH,CAAC,CAAC,CAEFrB,WAAW,CAACiB,SAAS,CAAC,CAEtB;AACA,GAAItJ,cAAc,CAAE,CAClB,KAAM,CAAA4J,cAAc,CAAGN,SAAS,CAACO,MAAM,CAACpB,IAAI,EAAIA,IAAI,CAAChC,MAAM,GAAK,WAAW,CAAC,CAACV,MAAM,CACnF5F,iBAAiB,CAAC2I,IAAI,GAAK,CACzB,GAAGA,IAAI,CACPhD,cAAc,CAAE8D,cAAc,CAC9BrC,UAAU,CAAE,EAAG;AACjB,CAAC,CAAC,CAAC,CACL,CAEArH,YAAY,CAAC,KAAK,CAAC,CACrB,CACF,CACF,CAAC,CAED,KAAM,CAAAsH,mBAAmB,CAAGA,CAAA,GAAM,CAChC;AACAtH,YAAY,CAAC,IAAI,CAAC,CAElBsD,KAAK,CAAC,GAAGhF,YAAY,oBAAoBiB,SAAS,EAAE,CAAC,CAClDqK,IAAI,CAACvG,QAAQ,EAAI,CAChB;AACA,GAAI,CAACA,QAAQ,CAACM,EAAE,CAAE,CAChB;AACA,KAAM,CAAAkG,kBAAkB,CAAG,CACzBxD,EAAE,CAAE9G,SAAS,CACb2C,IAAI,CAAE,sBAAsB,CAC5BwE,OAAO,CAAE,8BAA8B,CACvCW,UAAU,CAAE,EAAE,CACdzB,cAAc,CAAE,EAAE,CAClBiB,KAAK,CAAE,CACLC,MAAM,CAAE,UAAU,CAClBE,KAAK,CAAE,UACT,CAAC,CACD8C,cAAc,CAAE,oBAClB,CAAC,CAED,MAAO,CAAAD,kBAAkB,CAC3B,CAEA,MAAO,CAAAxG,QAAQ,CAACQ,IAAI,CAAC,CAAC,CACxB,CAAC,CAAC,CACD+F,IAAI,CAAChG,IAAI,EAAI,CACZ3D,iBAAiB,CAAC2D,IAAI,CAAC,CAEvB;AACA6C,oBAAoB,CAAC7C,IAAI,CAACyD,UAAU,CAAEzD,IAAI,CAACgC,cAAc,CAAC,CAE1D5F,YAAY,CAAC,KAAK,CAAC,CACrB,CAAC,CAAC,CACD+J,KAAK,CAACzF,KAAK,EAAI,CACdL,OAAO,CAACK,KAAK,CAAC,iCAAiC,CAAEA,KAAK,CAAC,CAEvD;AACA,KAAM,CAAAuF,kBAAkB,CAAG,CACzBxD,EAAE,CAAE9G,SAAS,CACb2C,IAAI,CAAE,sBAAsB,CAC5BwE,OAAO,CAAE,8BAA8B,CACvCW,UAAU,CAAE,EAAE,CACdzB,cAAc,CAAE,EAAE,CAClBiB,KAAK,CAAE,CACLC,MAAM,CAAE,UAAU,CAClBE,KAAK,CAAE,UACT,CAAC,CACD8C,cAAc,CAAE,oBAClB,CAAC,CAED7J,iBAAiB,CAAC4J,kBAAkB,CAAC,CACrCpD,oBAAoB,CAACoD,kBAAkB,CAACxC,UAAU,CAAEwC,kBAAkB,CAACjE,cAAc,CAAC,CACtF5F,YAAY,CAAC,KAAK,CAAC,CACrB,CAAC,CAAC,CACN,CAAC,CAED,KAAM,CAAAgK,iBAAiB,CAAIlC,CAAC,EAAK,CAC/B,KAAM,CAAE5F,IAAI,CAAExD,KAAM,CAAC,CAAGoJ,CAAC,CAACmC,MAAM,CAChChI,cAAc,CAAC2G,IAAI,GAAK,CACtB,GAAGA,IAAI,CACP,CAAC1G,IAAI,EAAGxD,KACV,CAAC,CAAC,CAAC,CAEH;AACA,GAAIwD,IAAI,GAAK,UAAU,CAAE,CACvB,KAAM,CAAAgI,KAAK,CAAGC,cAAc,CAACzL,KAAK,CAAC,CACnCuD,cAAc,CAAC2G,IAAI,GAAK,CACtB,GAAGA,IAAI,CACPpG,WAAW,CAAE0H,KACf,CAAC,CAAC,CAAC,CACL,CACF,CAAC,CAED,KAAM,CAAAE,eAAe,CAAGA,CAAA,GAAM,CAC5B;AACA,GAAI,CAAC1K,eAAe,CAAC,CAAC,CAAE,CACtBjC,KAAK,CAAC4M,OAAO,CAAC,qCAAqC,CAAC,CACpD5J,mBAAmB,CAAC,IAAI,CAAC,CACzB,OACF,CAEA;AACAF,qBAAqB,CAAC,IAAI,CAAC,CAC7B,CAAC,CAED,KAAM,CAAA+J,mBAAmB,CAAGA,CAAA,GAAM,CAChC;AACA,GAAIC,SAAS,CAACC,WAAW,CAAE,CACzBD,SAAS,CAACC,WAAW,CAACC,kBAAkB,CACrCC,QAAQ,EAAK,CACZ,KAAM,CAAAC,MAAM,CAAG,GAAGD,QAAQ,CAACE,MAAM,CAACC,QAAQ,IAAIH,QAAQ,CAACE,MAAM,CAACE,SAAS,EAAE,CACzE,KAAM,CAAAC,WAAW,CAAG,GAAGjL,cAAc,CAAC6G,WAAW,CAAC,CAAC,CAAC,IAAI7G,cAAc,CAAC6G,WAAW,CAAC,CAAC,CAAC,EAAE,CAEvF;AACApD,MAAM,CAACyH,IAAI,CACT,iDAAiDL,MAAM,gBAAgBI,WAAW,EAAE,CACpF,QACF,CAAC,CAEDtN,KAAK,CAACyH,OAAO,CAAC,8CAA8C,CAAC,CAC/D,CAAC,CACAZ,KAAK,EAAK,CACTL,OAAO,CAACK,KAAK,CAAC,8BAA8B,CAAEA,KAAK,CAAC,CAEpD;AACAf,MAAM,CAACyH,IAAI,CACT,sDAAsDlL,cAAc,CAAC6G,WAAW,CAAC,CAAC,CAAC,IAAI7G,cAAc,CAAC6G,WAAW,CAAC,CAAC,CAAC,EAAE,CACtH,QACF,CAAC,CAEDlJ,KAAK,CAAC8G,IAAI,CAAC,wDAAwD,CAAC,CACtE,CAAC,CACD,CAAE0G,kBAAkB,CAAE,IAAI,CAAEC,OAAO,CAAE,IAAI,CAAEC,UAAU,CAAE,CAAE,CAC3D,CAAC,CACH,CAAC,IAAM,CACL;AACA5H,MAAM,CAACyH,IAAI,CACT,mDAAmDlL,cAAc,CAAC6G,WAAW,CAAC,CAAC,CAAC,IAAI7G,cAAc,CAAC6G,WAAW,CAAC,CAAC,CAAC,EAAE,CACnH,QACF,CAAC,CAEDlJ,KAAK,CAAC4M,OAAO,CAAC,0CAA0C,CAAC,CAC3D,CACF,CAAC,CAED,KAAM,CAAAe,cAAc,CAAGA,CAAA,GAAM,CAC3B3N,KAAK,CAAC8G,IAAI,CAAC,+BAA+B,CAAC,CAE3C;AACA8G,UAAU,CAAC,IAAM,CACf,KAAM,CAAAC,aAAa,CAAGnI,SAAS,CAACsB,OAAO,CAEvC,GAAI,CAAC6G,aAAa,CAAE,CAClB7N,KAAK,CAAC6G,KAAK,CAAC,2BAA2B,CAAC,CACxC,OACF,CAEA;AACAzG,WAAW,CAACyN,aAAa,CAAE,CACzBC,KAAK,CAAE,CAAC,CAAE;AACVC,OAAO,CAAE,IAAI,CACbC,OAAO,CAAE,KAAK,CACdC,eAAe,CAAE,SACnB,CAAC,CAAC,CAAC9B,IAAI,CAAC+B,MAAM,EAAI,CAChB,GAAI,KAAAC,mBAAA,CACF;AACA,KAAM,CAAAC,GAAG,CAAG,GAAI,CAAA/N,KAAK,CAAC,CACpBgO,WAAW,CAAE,UAAU,CACvBC,IAAI,CAAE,IAAI,CACVhO,MAAM,CAAE,IACV,CAAC,CAAC,CAEF;AACA,KAAM,CAAAiO,OAAO,CAAGL,MAAM,CAACM,SAAS,CAAC,WAAW,CAAC,CAC7C,KAAM,CAAAC,QAAQ,CAAG,GAAG,CAAE;AACtB,KAAM,CAAAC,SAAS,CAAIR,MAAM,CAACS,MAAM,CAAGF,QAAQ,CAAIP,MAAM,CAACU,KAAK,CAE3D;AACAR,GAAG,CAACS,YAAY,CAAC,GAAG,CAAE,GAAG,CAAE,CAAC,CAAC,CAAE;AAC/BT,GAAG,CAACU,IAAI,CAAC,CAAC,CAAE,CAAC,CAAE,GAAG,CAAE,EAAE,CAAE,GAAG,CAAC,CAC5BV,GAAG,CAACW,YAAY,CAAC,CAAC,CAAE,CAAC,CAAE,CAAC,CAAC,CACzBX,GAAG,CAACY,OAAO,CAAC,WAAW,CAAE,MAAM,CAAC,CAChCZ,GAAG,CAACa,WAAW,CAAC,EAAE,CAAC,CACnBb,GAAG,CAACc,IAAI,CAAC,2BAA2B,CAAE,GAAG,CAAE,EAAE,CAAE,CAAEC,KAAK,CAAE,QAAS,CAAC,CAAC,CAEnE;AACAf,GAAG,CAACgB,QAAQ,CAACb,OAAO,CAAE,KAAK,CAAE,EAAE,CAAE,EAAE,CAAEE,QAAQ,CAAEC,SAAS,CAAC,CAEzD;AACAN,GAAG,CAACa,WAAW,CAAC,EAAE,CAAC,CACnBb,GAAG,CAACY,OAAO,CAAC,WAAW,CAAE,QAAQ,CAAC,CAClCZ,GAAG,CAACc,IAAI,CAAC,SAAS3K,WAAW,CAACE,IAAI,EAAE,CAAE,EAAE,CAAEiK,SAAS,CAAG,EAAE,CAAC,CACzDN,GAAG,CAACc,IAAI,CAAC,YAAY3K,WAAW,CAACG,aAAa,MAAAyJ,mBAAA,CAAK/M,aAAa,CAAC4J,IAAI,CAACqE,CAAC,EAAIA,CAAC,CAACpO,KAAK,GAAKsD,WAAW,CAACI,WAAW,CAAC,UAAAwJ,mBAAA,iBAA5DA,mBAAA,CAA8DjN,KAAK,GAAG,CAAE,EAAE,CAAEwN,SAAS,CAAG,EAAE,CAAC,CAC9IN,GAAG,CAACc,IAAI,CAAC,WAAW3K,WAAW,CAACK,YAAY,EAAE,CAAE,EAAE,CAAE8J,SAAS,CAAG,EAAE,CAAC,CACnEN,GAAG,CAACc,IAAI,CAAC,aAAa3K,WAAW,CAACO,QAAQ,IAAI0E,QAAQ,CAACjF,WAAW,CAACO,QAAQ,CAAC,GAAK,CAAC,CAAG,MAAM,CAAG,OAAO,EAAE,CAAE,EAAE,CAAE4J,SAAS,CAAG,EAAE,CAAC,CAC5HN,GAAG,CAACc,IAAI,CAAC,iBAAiBxC,cAAc,CAACnI,WAAW,CAACO,QAAQ,CAAC,EAAE,CAAE,EAAE,CAAE4J,SAAS,CAAG,EAAE,CAAC,CAErF;AACAN,GAAG,CAACkB,YAAY,CAAC,GAAG,CAAE,GAAG,CAAE,GAAG,CAAC,CAC/BlB,GAAG,CAACmB,IAAI,CAAC,EAAE,CAAE,GAAG,CAAE,GAAG,CAAE,GAAG,CAAC,CAC3BnB,GAAG,CAACa,WAAW,CAAC,EAAE,CAAC,CACnBb,GAAG,CAACW,YAAY,CAAC,GAAG,CAAE,GAAG,CAAE,GAAG,CAAC,CAC/BX,GAAG,CAACc,IAAI,CAAC,8CAA8C,CAAE,GAAG,CAAE,GAAG,CAAE,CAAEC,KAAK,CAAE,QAAS,CAAC,CAAC,CAEvF;AACAf,GAAG,CAACoB,IAAI,CAAC,4BAA4BtK,gBAAgB,MAAM,CAAC,CAE5DlF,KAAK,CAACyH,OAAO,CAAC,iCAAiC,CAAC,CAClD,CAAE,MAAOZ,KAAK,CAAE,CACdL,OAAO,CAACK,KAAK,CAAC,wBAAwB,CAAEA,KAAK,CAAC,CAC9C7G,KAAK,CAAC6G,KAAK,CAAC,gDAAgD,CAAC,CAC/D,CACF,CAAC,CAAC,CAACyF,KAAK,CAACzF,KAAK,EAAI,CAChBL,OAAO,CAACK,KAAK,CAAC,0BAA0B,CAAEA,KAAK,CAAC,CAChD7G,KAAK,CAAC6G,KAAK,CAAC,4CAA4C,CAAC,CAC3D,CAAC,CAAC,CACJ,CAAC,CAAE,GAAG,CAAC,CACT,CAAC,CAED,KAAM,CAAA4I,YAAY,CAAGA,CAAA,GAAM,CACzB,KAAM,CAAEhL,IAAI,CAAEC,aAAa,CAAEE,YAAa,CAAC,CAAGL,WAAW,CAEzD,GAAI,CAACE,IAAI,CAACiL,IAAI,CAAC,CAAC,CAAE,CAChB1P,KAAK,CAAC6G,KAAK,CAAC,wBAAwB,CAAC,CACrC,MAAO,MAAK,CACd,CAEA,GAAI,CAACnC,aAAa,CAACgL,IAAI,CAAC,CAAC,CAAE,CACzB1P,KAAK,CAAC6G,KAAK,CAAC,kCAAkC,CAAC,CAC/C,MAAO,MAAK,CACd,CAEA;AACA,GAAI,CAAC,UAAU,CAAC8I,IAAI,CAAC/K,YAAY,CAAC8K,IAAI,CAAC,CAAC,CAAC,CAAE,CACzC1P,KAAK,CAAC6G,KAAK,CAAC,6CAA6C,CAAC,CAC1D,MAAO,MAAK,CACd,CAEA,MAAO,KAAI,CACb,CAAC,CAED,KAAM,CAAA+I,aAAa,CAAGA,CAAA,GAAM,CAC1B,GAAI,CAACH,YAAY,CAAC,CAAC,CAAE,CACnB,OACF,CAEAlN,YAAY,CAAC,IAAI,CAAC,CAElB;AACA,KAAM,CAAAsN,WAAW,CAAG,CAClB/N,SAAS,CAAEO,cAAc,SAAdA,cAAc,iBAAdA,cAAc,CAAEuG,EAAE,CAC7BkH,MAAM,CAAEnN,YAAY,SAAZA,YAAY,iBAAZA,YAAY,CAAEiG,EAAE,CACxBmH,UAAU,CAAEpN,YAAY,SAAZA,YAAY,iBAAZA,YAAY,CAAEkG,MAAM,CAChCpE,IAAI,CAAEF,WAAW,CAACE,IAAI,CACtBC,aAAa,CAAEH,WAAW,CAACG,aAAa,CACxCC,WAAW,CAAEJ,WAAW,CAACI,WAAW,CACpCC,YAAY,CAAEL,WAAW,CAACK,YAAY,CACtCE,QAAQ,CAAEP,WAAW,CAACO,QAAQ,CAC9BC,WAAW,CAAE2H,cAAc,CAACnI,WAAW,CAACO,QAAQ,CAClD,CAAC,CAED;AACA;AACAe,KAAK,CAAC,GAAGhF,YAAY,eAAe,CAAE,CACpCoF,MAAM,CAAE,MAAM,CACdoB,OAAO,CAAE,CACP,cAAc,CAAE,kBAClB,CAAC,CACDC,IAAI,CAAEC,IAAI,CAACC,SAAS,CAACqI,WAAW,CAClC,CAAC,CAAC,CACD1D,IAAI,CAACvG,QAAQ,EAAI,CAChB;AACA;AACA,MAAO,CAAAA,QAAQ,CAACM,EAAE,CAAGN,QAAQ,CAACQ,IAAI,CAAC,CAAC,CAAG,CACrCqB,OAAO,CAAE,IAAI,CACbuI,SAAS,CAAE,KAAK1H,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,MAAM,CAAC,CAAC,CAAG,MAAM,CAAC,CAAG,MAAM,EAC7D,CAAC,CACH,CAAC,CAAC,CACD2D,IAAI,CAAChG,IAAI,EAAI,CACZ;AACAhB,mBAAmB,CAACgB,IAAI,CAAC6J,SAAS,CAAC,CAEnC/K,kBAAkB,CAAC,IAAI,CAAC,CACxB1C,YAAY,CAAC,KAAK,CAAC,CAEnB;AACAvC,KAAK,CAACyH,OAAO,CAAC,qBAAqB,CAAE,CACnCwF,QAAQ,CAAE,cAAc,CACxBgD,SAAS,CAAE,IAAI,CACfC,eAAe,CAAE,KAAK,CACtBC,YAAY,CAAE,IAAI,CAClBC,YAAY,CAAE,IAAI,CAClBC,SAAS,CAAE,IAAI,CACfC,KAAK,CAAE,CACLrC,eAAe,CAAE,SAAS,CAC1BsC,KAAK,CAAE,SACT,CACF,CAAC,CAAC,CAEF;AACA,GAAI5N,YAAY,CAAE,CAChB,KAAM,CAAA6N,YAAY,CAAG/N,YAAY,CAACoI,GAAG,CAACC,IAAI,EAAI,CAC5C,GAAIA,IAAI,CAAClC,EAAE,GAAKjG,YAAY,CAACiG,EAAE,CAAE,CAC/B,MAAO,CAAE,GAAGkC,IAAI,CAAEhC,MAAM,CAAE,UAAW,CAAC,CACxC,CACA,MAAO,CAAAgC,IAAI,CACb,CAAC,CAAC,CAEFpI,eAAe,CAAC8N,YAAY,CAAC,CAE7B;AACA,GAAInO,cAAc,CAAE,CAClBG,iBAAiB,CAAC2I,IAAI,GAAK,CACzB,GAAGA,IAAI,CACPhD,cAAc,CAAEgD,IAAI,CAAChD,cAAc,CAAG,CACxC,CAAC,CAAC,CAAC,CACL,CACF,CACF,CAAC,CAAC,CACDmE,KAAK,CAACzF,KAAK,EAAI,CACdL,OAAO,CAACK,KAAK,CAAC,6BAA6B,CAAEA,KAAK,CAAC,CACnD7G,KAAK,CAAC6G,KAAK,CAAC,gDAAgD,CAAC,CAC7DtE,YAAY,CAAC,KAAK,CAAC,CACrB,CAAC,CAAC,CACJ,CAAC,CAED;AACA,KAAM,CAAAkO,kBAAkB,CAAGA,CAAA,GAAM,CAC/BlO,YAAY,CAAC,IAAI,CAAC,CAElB;AACAa,iBAAiB,CAAC,KAAK,CAAC,CAExB;AACAyC,KAAK,CAAC,GAAGhF,YAAY,iBAAiB,CAAC,CACpCsL,IAAI,CAACvG,QAAQ,EAAI,CAChB,GAAI,CAACA,QAAQ,CAACM,EAAE,CAAE,CAChB,KAAM,IAAI,CAAAU,KAAK,CAAC,uBAAuBhB,QAAQ,CAACkD,MAAM,EAAE,CAAC,CAC3D,CACA;AACAkB,aAAa,CAAC,CAAC,CACfpG,kBAAkB,CAAC,GAAI,CAAAqG,IAAI,CAAC,CAAC,CAACC,kBAAkB,CAAC,CAAC,CAAC,CACnDlK,KAAK,CAACyH,OAAO,CAAC,sCAAsC,CAAC,CACvD,CAAC,CAAC,CACD6E,KAAK,CAACzF,KAAK,EAAI,CACdL,OAAO,CAACK,KAAK,CAAC,gCAAgC,CAAEA,KAAK,CAAC,CAEtD;AACAmD,aAAa,CAAC,CAAC,CACfpG,kBAAkB,CAAC,GAAI,CAAAqG,IAAI,CAAC,CAAC,CAACC,kBAAkB,CAAC,CAAC,CAAC,CACnDlK,KAAK,CAAC8G,IAAI,CAAC,qCAAqC,CAAC,CACnD,CAAC,CAAC,CACN,CAAC,CAED,KAAM,CAAA4J,eAAe,CAAGA,CAAA,GAAM,CAC5BlN,YAAY,CAAC,CAACD,SAAS,CAAC,CAC1B,CAAC,CAED;AACA,KAAM,CAAAmJ,cAAc,CAAIvL,KAAK,EAAK,CAChC,MAAO,CAAAL,WAAW,CAAG0I,QAAQ,CAACrI,KAAK,CAAC,CACtC,CAAC,CAED;AACA,KAAM,CAAAwP,uBAAuB,CAAGA,CAAA,GAAM,CACpC7N,qBAAqB,CAAC,KAAK,CAAC,CAC5BmC,kBAAkB,CAAC,KAAK,CAAC,CACzBrC,eAAe,CAAC,IAAI,CAAC,CACrBc,eAAe,CAAC,KAAK,CAAC,CAAE;AACxBsG,aAAa,CAAC,CAAC,CACjB,CAAC,CAED;AACA,KAAM,CAAA4G,qBAAqB,CAAIvG,CAAC,EAAK,CACnC,KAAM,CAAE5F,IAAI,CAAExD,KAAM,CAAC,CAAGoJ,CAAC,CAACmC,MAAM,CAChCnH,WAAW,CAAC8F,IAAI,GAAK,CACnB,GAAGA,IAAI,CACP,CAAC1G,IAAI,EAAGxD,KACV,CAAC,CAAC,CAAC,CACL,CAAC,CAED;AACA,KAAM,CAAA4P,iBAAiB,CAAGA,CAAA,GAAM,CAC9B7N,mBAAmB,CAAC,KAAK,CAAC,CAC1BE,oBAAoB,CAAC,IAAI,CAAC,CAC5B,CAAC,CAED;AACA,KAAM,CAAA4N,gBAAgB,CAAGA,CAAA,GAAM,CAC7B5N,oBAAoB,CAAC,KAAK,CAAC,CAC3BF,mBAAmB,CAAC,IAAI,CAAC,CAC3B,CAAC,CAED;AACAvE,SAAS,CAAC,IAAM,CACd;AACA,GAAIkE,YAAY,EAAIV,eAAe,CAAC,CAAC,EAAIc,gBAAgB,CAAE,CACzDC,mBAAmB,CAAC,KAAK,CAAC,CAC1BF,qBAAqB,CAAC,IAAI,CAAC,CAC3B9C,KAAK,CAACyH,OAAO,CAAC,wDAAwD,CAAC,CACzE,CACF,CAAC,CAAE,CAACxF,eAAe,CAAEU,YAAY,CAAEI,gBAAgB,CAAC,CAAC,CAErD,GAAIT,SAAS,EAAI,CAACD,cAAc,CAAE,CAChC,mBACE3B,KAAA,QAAKqQ,SAAS,CAAC,oDAAoD,CAAAC,QAAA,eACjExQ,IAAA,CAACX,OAAO,EAACoR,IAAI,CAAC,IAAI,CAAE,CAAC,cACrBzQ,IAAA,MAAGuQ,SAAS,CAAC,6CAA6C,CAAAC,QAAA,CAAC,4BAA0B,CAAG,CAAC,EACtF,CAAC,CAEV,CAEA,mBACEtQ,KAAA,QAAKqQ,SAAS,CAAC,mBAAmB,CAAAC,QAAA,eAEhCtQ,KAAA,QAAKqQ,SAAS,CAAC,mCAAmC,CAAAC,QAAA,eAChDxQ,IAAA,OAAIuQ,SAAS,CAAC,gCAAgC,CAAAC,QAAA,CAAC,WAAS,CAAI,CAAC,cAC7DxQ,IAAA,MAAGuQ,SAAS,CAAC,qCAAqC,CAAAC,QAAA,CAAC,yCAAuC,CAAG,CAAC,CAC7F7N,cAAc,eACbzC,KAAA,QAAKqQ,SAAS,CAAC,uCAAuC,CAAAC,QAAA,eACpDxQ,IAAA,SAAMuQ,SAAS,CAAC,qDAAqD,CAAO,CAAC,cAC7EvQ,IAAA,SAAMuQ,SAAS,CAAC,oBAAoB,CAAAC,QAAA,CAAC,qBAAmB,CAAM,CAAC,CAC9DrN,eAAe,eACdjD,KAAA,SAAMqQ,SAAS,CAAC,yBAAyB,CAAAC,QAAA,EAAC,gBAAc,CAACrN,eAAe,EAAO,CAChF,EACE,CACN,EACE,CAAC,cAGNjD,KAAA,QAAKqQ,SAAS,CAAC,iCAAiC,CAAAC,QAAA,eAC9CxQ,IAAA,CAACf,MAAM,EACLyR,OAAO,CAAC,SAAS,CACjBD,IAAI,CAAC,IAAI,CACTE,QAAQ,cAAE3Q,IAAA,CAACrB,eAAe,EAAC4R,SAAS,CAAC,SAAS,CAAE,CAAE,CAClDK,OAAO,CAAEV,eAAgB,CACzBK,SAAS,CAAC,mCAAmC,CAAAC,QAAA,CAE5CzN,SAAS,CAAG,iBAAiB,CAAG,iBAAiB,CAC5C,CAAC,CACRJ,cAAc,EAAII,SAAS,eAC1B/C,IAAA,CAACf,MAAM,EACLyR,OAAO,CAAC,SAAS,CACjBD,IAAI,CAAC,IAAI,CACTE,QAAQ,cAAE3Q,IAAA,CAAClB,yBAAyB,EAACyR,SAAS,CAAC,SAAS,CAAE,CAAE,CAC5DK,OAAO,CAAE1J,eAAgB,CACzBqJ,SAAS,CAAE9M,SAAS,CAAG,iCAAiC,CAAG,+BAAgC,CAAA+M,QAAA,CAE1F/M,SAAS,CAAG,oBAAoB,CAAG,mBAAmB,CACjD,CACT,EACE,CAAC,CAGLV,SAAS,eACR7C,KAAA,CAAClB,IAAI,EACH6R,KAAK,CAAC,EAAE,CACRC,QAAQ,CAAC,EAAE,CACXC,MAAM,CAAC,EAAE,CACTC,KAAK,CAAC,EAAE,CACRJ,OAAO,CAAEA,CAAA,GAAM,CAAC,CAAE,CAClBL,SAAS,CAAC,sBAAsB,CAAAC,QAAA,eAEhCtQ,KAAA,QAAKqQ,SAAS,CAAC,sBAAsB,CAAAC,QAAA,EAAC,GAAC,CACpC7N,cAAc,cACb;AACA3C,IAAA,QACEuQ,SAAS,CAAC,kDAAkD,CAC5DU,GAAG,CAAEpO,SAAS,EAAI,GAAGyC,MAAM,CAAC9D,QAAQ,CAAC+D,QAAQ,KAAKD,MAAM,CAAC9D,QAAQ,CAACgE,QAAQ,yBAA0B,CACpG0L,GAAG,CAAC,mBAAmB,CACxB,CAAC,cAEF;AACAlR,IAAA,UACEuQ,SAAS,CAAC,kDAAkD,CAC5DU,GAAG,CAAEpO,SAAS,EAAI/B,YAAY,CAACC,IAAK,CACpCoQ,QAAQ,MACRC,KAAK,MACLC,IAAI,MACJC,QAAQ,MACT,CACF,cACDpR,KAAA,QAAKqQ,SAAS,CAAC,gGAAgG,CAAAC,QAAA,eAC7GxQ,IAAA,CAACpB,OAAO,EAAC2R,SAAS,CAAC,cAAc,CAAE,CAAC,cACpCvQ,IAAA,SAAAwQ,QAAA,CAAO7N,cAAc,CAAG,WAAW,CAAG,aAAa,CAAO,CAAC,EACxD,CAAC,cAGN3C,IAAA,QAAKuQ,SAAS,CAAC,qEAAqE,CAAAC,QAAA,cAClFtQ,KAAA,QAAKqQ,SAAS,CAAC,6CAA6C,CAAAC,QAAA,eAE1DtQ,KAAA,QAAKqQ,SAAS,CAAC,kCAAkC,CAAAC,QAAA,eAC/CxQ,IAAA,SAAAwQ,QAAA,CAAM,SAAO,CAAM,CAAC,cACpBxQ,IAAA,QAAKuQ,SAAS,CAAC,gBAAgB,CAAAC,QAAA,CAC5BjN,YAAY,CAACqE,MAAM,CAAG,CAAC,CACtBrE,YAAY,CAAC8G,GAAG,CAAE5D,MAAM,eACtBzG,IAAA,WAEE4Q,OAAO,CAAEA,CAAA,GAAMhK,iBAAiB,CAACH,MAAM,CAAC2B,EAAE,CAAE,CAC5CmI,SAAS,CAAE,6BACTlN,WAAW,GAAKoD,MAAM,CAAC2B,EAAE,CACrB,0BAA0B,CAC1B,aAAa,EAChB,CAAAoI,QAAA,CAEF/J,MAAM,CAACxC,IAAI,EARPwC,MAAM,CAAC2B,EASN,CACT,CAAC,cAEFlI,KAAA,CAAAE,SAAA,EAAAoQ,QAAA,eACExQ,IAAA,WACE4Q,OAAO,CAAEA,CAAA,GAAMhK,iBAAiB,CAAC,MAAM,CAAE,CACzC2J,SAAS,CAAE,6BACTlN,WAAW,GAAK,MAAM,CAAG,0BAA0B,CAAG,aAAa,EAClE,CAAAmN,QAAA,CACJ,cAED,CAAQ,CAAC,cACTxQ,IAAA,WACE4Q,OAAO,CAAEA,CAAA,GAAMhK,iBAAiB,CAAC,SAAS,CAAE,CAC5C2J,SAAS,CAAE,6BACTlN,WAAW,GAAK,SAAS,CAAG,0BAA0B,CAAG,aAAa,EACrE,CAAAmN,QAAA,CACJ,eAED,CAAQ,CAAC,EACT,CACH,CACE,CAAC,EACH,CAAC,CAGL7N,cAAc,eACbzC,KAAA,QAAKqQ,SAAS,CAAC,kCAAkC,CAAAC,QAAA,eAC/CxQ,IAAA,SAAAwQ,QAAA,CAAM,OAAK,CAAM,CAAC,cAClBtQ,KAAA,QAAKqQ,SAAS,CAAC,gBAAgB,CAAAC,QAAA,eAC7BxQ,IAAA,WACE4Q,OAAO,CAAEA,CAAA,GAAMrJ,cAAc,CAAC,WAAW,CAAE,CAC3CgJ,SAAS,CAAE,6BACT1M,QAAQ,GAAK,WAAW,CAAG,0BAA0B,CAAG,aAAa,EACpE,CAAA2M,QAAA,CACJ,WAED,CAAQ,CAAC,cACTxQ,IAAA,WACE4Q,OAAO,CAAEA,CAAA,GAAMrJ,cAAc,CAAC,KAAK,CAAE,CACrCgJ,SAAS,CAAE,6BACT1M,QAAQ,GAAK,KAAK,CAAG,0BAA0B,CAAG,aAAa,EAC9D,CAAA2M,QAAA,CACJ,KAED,CAAQ,CAAC,cACTxQ,IAAA,WACE4Q,OAAO,CAAEA,CAAA,GAAMrJ,cAAc,CAAC,WAAW,CAAE,CAC3CgJ,SAAS,CAAE,6BACT1M,QAAQ,GAAK,WAAW,CAAG,0BAA0B,CAAG,aAAa,EACpE,CAAA2M,QAAA,CACJ,WAED,CAAQ,CAAC,cACTxQ,IAAA,WACE4Q,OAAO,CAAEA,CAAA,GAAMrJ,cAAc,CAAC,WAAW,CAAE,CAC3CgJ,SAAS,CAAE,6BACT1M,QAAQ,GAAK,WAAW,CAAG,0BAA0B,CAAG,aAAa,EACpE,CAAA2M,QAAA,CACJ,WAED,CAAQ,CAAC,EACN,CAAC,EACH,CACN,EACE,CAAC,CACH,CAAC,EACH,CAAC,cACNtQ,KAAA,QAAKqQ,SAAS,CAAC,uCAAuC,CAAAC,QAAA,eACpDxQ,IAAA,MAAGuQ,SAAS,CAAC,aAAa,CAAAC,QAAA,CAAE7N,cAAc,CAAG,iBAAiB,CAAG,sBAAsB,CAAI,CAAC,cAC5F3C,IAAA,MAAGuQ,SAAS,CAAC,cAAc,CAAAC,QAAA,CACxB7N,cAAc,cACbzC,KAAA,CAAAE,SAAA,EAAAoQ,QAAA,EAAE,mFAEA,cAAAxQ,IAAA,QAAK,CAAC,4GAEN,cAAAA,IAAA,QAAK,CAAC,mEAER,EAAE,CAAC,cAEHE,KAAA,CAAAE,SAAA,EAAAoQ,QAAA,EAAE,gEAEA,cAAAxQ,IAAA,QAAK,CAAC,8EAEN,cAAAA,IAAA,QAAK,CAAC,4DAER,EAAE,CACH,CACA,CAAC,EACD,CAAC,EACF,CACP,cAGDE,KAAA,QAAKqQ,SAAS,CAAC,MAAM,CAAAC,QAAA,eACnBtQ,KAAA,QAAKqQ,SAAS,CAAC,wBAAwB,CAAAC,QAAA,eACrCxQ,IAAA,CAACf,MAAM,EACLyR,OAAO,CAAC,SAAS,CACjBD,IAAI,CAAC,IAAI,CACTG,OAAO,CAAEA,CAAA,GAAMrP,QAAQ,CAAC,GAAG,CAAE,CAC7BgP,SAAS,CAAC,MAAM,CAAAC,QAAA,CACjB,cAED,CAAQ,CAAC,cACTxQ,IAAA,CAACf,MAAM,EACLyR,OAAO,CAAC,SAAS,CACjBD,IAAI,CAAC,IAAI,CACTG,OAAO,CAAEA,CAAA,GAAMrP,QAAQ,CAAC,mBAAmBD,SAAS,EAAE,CAAE,CACxDiP,SAAS,CAAC,mCAAmC,CAAAC,QAAA,CAC9C,sBAED,CAAQ,CAAC,EACN,CAAC,cAENxQ,IAAA,CAAChB,IAAI,EACH6R,KAAK,CAAC,EAAE,CACRC,QAAQ,CAAC,EAAE,CACXC,MAAM,CAAC,EAAE,CACTC,KAAK,CAAC,EAAE,CACRJ,OAAO,CAAEA,CAAA,GAAM,CAAC,CAAE,CAClBL,SAAS,CAAC,4CAA4C,CAAAC,QAAA,cAEtDxQ,IAAA,QAAKuQ,SAAS,CAAC,mCAAmC,CAAAC,QAAA,cAChDtQ,KAAA,QAAAsQ,QAAA,eACEtQ,KAAA,QAAKqQ,SAAS,CAAC,uBAAuB,CAAAC,QAAA,eACpCxQ,IAAA,CAACtB,UAAU,EAAC6R,SAAS,CAAC,mDAAmD,CAAE,CAAC,cAC5ErQ,KAAA,QAAAsQ,QAAA,eACExQ,IAAA,OAAIuQ,SAAS,CAAC,uBAAuB,CAAAC,QAAA,CAAE3O,cAAc,SAAdA,cAAc,iBAAdA,cAAc,CAAEoC,IAAI,CAAK,CAAC,cACjEjE,IAAA,MAAGuQ,SAAS,CAAC,gDAAgD,CAAAC,QAAA,CAAE3O,cAAc,SAAdA,cAAc,iBAAdA,cAAc,CAAE4G,OAAO,CAAI,CAAC,EACxF,CAAC,EACH,CAAC,cAENvI,KAAA,QAAKqQ,SAAS,CAAC,uBAAuB,CAAAC,QAAA,eACpCxQ,IAAA,CAACzB,SAAS,EAACgS,SAAS,CAAC,mDAAmD,CAAE,CAAC,cAC3ErQ,KAAA,QAAAsQ,QAAA,eACExQ,IAAA,MAAGuQ,SAAS,CAAC,gDAAgD,CAAAC,QAAA,CAAE3O,cAAc,SAAdA,cAAc,iBAAdA,cAAc,CAAElB,KAAK,CAAI,CAAC,cACzFX,IAAA,MAAGuQ,SAAS,CAAC,gDAAgD,CAAAC,QAAA,CAAE3O,cAAc,SAAdA,cAAc,iBAAdA,cAAc,CAAE8G,aAAa,CAAI,CAAC,EAC9F,CAAC,EACH,CAAC,EACH,CAAC,CACH,CAAC,CACF,CAAC,cAGPzI,KAAA,QAAKqQ,SAAS,CAAC,mCAAmC,CAAAC,QAAA,eAChDtQ,KAAA,MAAGqQ,SAAS,CAAC,yBAAyB,CAAAC,QAAA,EAAC,yBAAuB,CAAC3O,cAAc,SAAdA,cAAc,iBAAdA,cAAc,CAAE8F,cAAc,CAAC,GAAC,CAAC9F,cAAc,SAAdA,cAAc,iBAAdA,cAAc,CAAEuH,UAAU,CAAC,GAAC,EAAG,CAAC,cAChIlJ,KAAA,QAAKqQ,SAAS,CAAC,uCAAuC,CAAAC,QAAA,eACpDxQ,IAAA,SAAMuQ,SAAS,CAAC,uBAAuB,CAAAC,QAAA,CACpCvN,YAAY,CACT,2CAA2C,CAC3C,wBAAwB1C,gBAAgB,CAAC,IAAI,UAAU,CAEvD,CAAC,cACPP,IAAA,CAACf,MAAM,EACLyR,OAAO,CAAC,OAAO,CACfD,IAAI,CAAC,IAAI,CACTE,QAAQ,cAAE3Q,IAAA,CAACvB,aAAa,EAAC8R,SAAS,CAAC,SAAS,CAAE,CAAE,CAChDK,OAAO,CAAEX,kBAAmB,CAC5BM,SAAS,CAAC,MAAM,CAAAC,QAAA,CACjB,aAED,CAAQ,CAAC,EACN,CAAC,EACH,CAAC,EACH,CAAC,cAGNtQ,KAAA,QAAKqQ,SAAS,CAAC,MAAM,CAAAC,QAAA,eACnBtQ,KAAA,QAAKqQ,SAAS,CAAC,wCAAwC,CAAAC,QAAA,eACrDxQ,IAAA,OAAIuQ,SAAS,CAAC,uBAAuB,CAAAC,QAAA,CAAC,uBAAqB,CAAI,CAAC,cAChExQ,IAAA,CAACf,MAAM,EACLwR,IAAI,CAAC,IAAI,CACTC,OAAO,CAAC,SAAS,CACjBC,QAAQ,cAAE3Q,IAAA,CAACvB,aAAa,EAAC8R,SAAS,CAAC,SAAS,CAAE,CAAE,CAChDK,OAAO,CAAEX,kBAAmB,CAAAO,QAAA,CAC7B,SAED,CAAQ,CAAC,EACN,CAAC,CAEL1O,SAAS,cACR9B,IAAA,QAAKuQ,SAAS,CAAC,0BAA0B,CAAAC,QAAA,cACvCxQ,IAAA,CAACX,OAAO,GAAE,CAAC,CACR,CAAC,cAENa,KAAA,CAAAE,SAAA,EAAAoQ,QAAA,eAEExQ,IAAA,QAAKuQ,SAAS,CAAC,yEAAyE,CAAAC,QAAA,CACrFvO,YAAY,CAACoI,GAAG,CAAEC,IAAI,eACrBtK,IAAA,QAEEuQ,SAAS,CAAE;AAC7B;AACA,sBAAsBjG,IAAI,CAAChC,MAAM,GAAK,WAAW,CACzBnG,YAAY,EAAIA,YAAY,CAACiG,EAAE,GAAKkC,IAAI,CAAClC,EAAE,CACzC,yCAAyC,CACzC,oEAAoE,CACtE,wCAAwC;AAChE,mBACoB,CACFwI,OAAO,CAAEA,CAAA,GAAMlG,gBAAgB,CAACJ,IAAI,CAAE,CAAAkG,QAAA,CAErClG,IAAI,CAACjC,MAAM,EAZPiC,IAAI,CAAClC,EAaP,CACN,CAAC,CACC,CAAC,cAGNlI,KAAA,QAAKqQ,SAAS,CAAC,mCAAmC,CAAAC,QAAA,eAChDxQ,IAAA,QAAAwQ,QAAA,CACGrO,YAAY,cACXjC,KAAA,MAAGqQ,SAAS,CAAC,aAAa,CAAAC,QAAA,EAAC,iBACV,cAAAxQ,IAAA,SAAMuQ,SAAS,CAAC,iBAAiB,CAAAC,QAAA,CAAErO,YAAY,CAACkG,MAAM,CAAO,CAAC,EAC5E,CAAC,cAEJrI,IAAA,MAAGuQ,SAAS,CAAC,wCAAwC,CAAAC,QAAA,CAAC,kBAAgB,CAAG,CAC1E,CACE,CAAC,cACNtQ,KAAA,CAACjB,MAAM,EACLyR,OAAO,CAAC,SAAS,CACjBa,QAAQ,CAAE,CAACpP,YAAa,CACxByO,OAAO,CAAEzE,eAAgB,CACzBoE,SAAS,CAAC,kFAAkF,CAAAC,QAAA,EAE3F,CAAC/O,eAAe,CAAC,CAAC,eAAIzB,IAAA,CAACjB,eAAe,EAACwR,SAAS,CAAC,cAAc,CAAE,CAAC,CAClE9O,eAAe,CAAC,CAAC,CAAG,oBAAoB,CAAG,4BAA4B,EAClE,CAAC,EACN,CAAC,EACN,CACH,EACE,CAAC,cAGNzB,IAAA,CAACT,KAAK,EACJiS,MAAM,CAAEnP,kBAAmB,CAC3BoP,OAAO,CAAEA,CAAA,GAAM,CACbnP,qBAAqB,CAAC,KAAK,CAAC,CAC5BY,eAAe,CAAC,KAAK,CAAC,CACtBuB,kBAAkB,CAAC,KAAK,CAAC,CAC3B,CAAE,CACFoM,KAAK,CAAErM,eAAe,CAAG,oBAAoB,CAAG,iBAAkB,CAClEiM,IAAI,CAAC,IAAI,CACTM,MAAM,CACJvM,eAAe,cACbtE,KAAA,QAAKqQ,SAAS,CAAC,2BAA2B,CAAAC,QAAA,eACxCxQ,IAAA,CAACf,MAAM,EACLyR,OAAO,CAAC,SAAS,CACjBE,OAAO,CAAET,uBAAwB,CAAAK,QAAA,CAClC,iBAED,CAAQ,CAAC,cACTxQ,IAAA,CAACf,MAAM,EACLyR,OAAO,CAAC,SAAS,CACjBE,OAAO,CAAEzD,cAAe,CACxBoD,SAAS,CAAC,0CAA0C,CAAAC,QAAA,CACrD,iBAED,CAAQ,CAAC,cACTxQ,IAAA,CAACf,MAAM,EACLyR,OAAO,CAAC,SAAS,CACjBE,OAAO,CAAEvE,mBAAoB,CAC7BkE,SAAS,CAAC,8CAA8C,CAAAC,QAAA,CACzD,gBAED,CAAQ,CAAC,EACN,CAAC,CACJ,IACL,CAAAA,QAAA,CAEAhM,eAAe,cACdtE,KAAA,QAAKqQ,SAAS,CAAC,aAAa,CAACmB,GAAG,CAAExM,SAAU,CAAAsL,QAAA,eAC1CxQ,IAAA,QAAKuQ,SAAS,CAAC,0BAA0B,CAAAC,QAAA,cACvCxQ,IAAA,QAAKuQ,SAAS,CAAC,uEAAuE,CAAAC,QAAA,cACpFxQ,IAAA,CAACnB,eAAe,EAAC0R,SAAS,CAAC,sBAAsB,CAAE,CAAC,CACjD,CAAC,CACH,CAAC,cACNvQ,IAAA,OAAIuQ,SAAS,CAAC,4BAA4B,CAAAC,QAAA,CAAC,+BAA6B,CAAI,CAAC,cAE7ExQ,IAAA,QAAKuQ,SAAS,CAAC,4CAA4C,CAAAC,QAAA,cACzDtQ,KAAA,QAAKqQ,SAAS,CAAC,0BAA0B,CAAAC,QAAA,eACvCxQ,IAAA,QAAKuQ,SAAS,CAAC,aAAa,CAAAC,QAAA,CAAC,oBAAkB,CAAK,CAAC,cACrDxQ,IAAA,QAAKuQ,SAAS,CAAC,WAAW,CAAAC,QAAA,CAAE9L,gBAAgB,CAAM,CAAC,cAEnD1E,IAAA,QAAAwQ,QAAA,CAAK,OAAK,CAAK,CAAC,cAChBxQ,IAAA,QAAAwQ,QAAA,CAAMzM,WAAW,CAACE,IAAI,CAAM,CAAC,cAE7BjE,IAAA,QAAAwQ,QAAA,CAAK,iBAAe,CAAK,CAAC,cAC1BxQ,IAAA,QAAAwQ,QAAA,CAAMzM,WAAW,CAACG,aAAa,CAAM,CAAC,cAEtClE,IAAA,QAAAwQ,QAAA,CAAK,eAAa,CAAK,CAAC,cACxBxQ,IAAA,QAAAwQ,QAAA,EAAArP,oBAAA,CAAMP,aAAa,CAAC4J,IAAI,CAACqE,CAAC,EAAIA,CAAC,CAACpO,KAAK,GAAKsD,WAAW,CAACI,WAAW,CAAC,UAAAhD,oBAAA,iBAA5DA,oBAAA,CAA8DT,KAAK,CAAM,CAAC,cAEhFV,IAAA,QAAAwQ,QAAA,CAAK,eAAa,CAAK,CAAC,cACxBtQ,KAAA,QAAAsQ,QAAA,EAAK,OAAK,CAACrO,YAAY,SAAZA,YAAY,iBAAZA,YAAY,CAAEkG,MAAM,EAAM,CAAC,cAEtCrI,IAAA,QAAAwQ,QAAA,CAAK,WAAS,CAAK,CAAC,cACpBxQ,IAAA,QAAAwQ,QAAA,EAAApP,qBAAA,CAAMZ,gBAAgB,CAACgK,IAAI,CAACmH,CAAC,EAAIA,CAAC,CAAClR,KAAK,GAAKsD,WAAW,CAACO,QAAQ,CAAC,UAAAlD,qBAAA,iBAA5DA,qBAAA,CAA8DV,KAAK,CAAM,CAAC,cAEhFV,IAAA,QAAAwQ,QAAA,CAAK,iBAAe,CAAK,CAAC,cAC1BxQ,IAAA,QAAAwQ,QAAA,EAAAnP,qBAAA,CAAMR,eAAe,CAAC2J,IAAI,CAACoH,CAAC,EAAIA,CAAC,CAACnR,KAAK,GAAKsD,WAAW,CAACM,aAAa,CAAC,UAAAhD,qBAAA,iBAAhEA,qBAAA,CAAkEX,KAAK,CAAM,CAAC,cAEpFV,IAAA,QAAAwQ,QAAA,CAAK,cAAY,CAAK,CAAC,cACvBxQ,IAAA,QAAAwQ,QAAA,CAAM,GAAI,CAAA/G,IAAI,CAAC,CAAC,CAACoI,cAAc,CAACC,SAAS,CAAE,CACzCC,IAAI,CAAE,SAAS,CACfC,KAAK,CAAE,SAAS,CAChBC,GAAG,CAAE,SAAS,CACdC,IAAI,CAAE,SAAS,CACfC,MAAM,CAAE,SAAS,CACjBC,MAAM,CAAE,SAAS,CACjBC,MAAM,CAAE,IACV,CAAC,CAAC,CAAM,CAAC,cAETrS,IAAA,QAAAwQ,QAAA,CAAK,OAAK,CAAK,CAAC,cAChBtQ,KAAA,QAAAsQ,QAAA,EAAK,QAAC,CAAClQ,WAAW,CAAC,KAAG,EAAK,CAAC,cAE5BN,IAAA,QAAAwQ,QAAA,CAAK,SAAO,CAAK,CAAC,cAClBtQ,KAAA,QAAAsQ,QAAA,EAAK,QAAC,CAACtE,cAAc,CAACnI,WAAW,CAACO,QAAQ,CAAC,CAAC,UAAG,CAAChE,WAAW,CAAC,QAAM,CAACyD,WAAW,CAACO,QAAQ,CAAC,GAAC,CAAC0E,QAAQ,CAACjF,WAAW,CAACO,QAAQ,CAAC,GAAK,CAAC,CAAG,MAAM,CAAG,OAAO,CAAC,GAAC,EAAK,CAAC,EACtJ,CAAC,CACH,CAAC,cAENpE,KAAA,QAAKqQ,SAAS,CAAC,uBAAuB,CAAAC,QAAA,EAAC,sDACe,CAACzM,WAAW,CAACK,YAAY,EAC1E,CAAC,EACH,CAAC,cAENpE,IAAA,QAAAwQ,QAAA,CACG1O,SAAS,cACR5B,KAAA,QAAKqQ,SAAS,CAAC,gDAAgD,CAAAC,QAAA,eAC7DxQ,IAAA,CAACX,OAAO,EAACoR,IAAI,CAAC,IAAI,CAAE,CAAC,cACrBzQ,IAAA,MAAGuQ,SAAS,CAAC,kBAAkB,CAAAC,QAAA,CAAC,4BAA0B,CAAG,CAAC,EAC3D,CAAC,cAENtQ,KAAA,CAAAE,SAAA,EAAAoQ,QAAA,eACEtQ,KAAA,QAAKqQ,SAAS,CAAC,MAAM,CAAAC,QAAA,eACnBxQ,IAAA,MAAAwQ,QAAA,CAAG,wBAAsB,CAAG,CAAC,cAC7BtQ,KAAA,QAAKqQ,SAAS,CAAC,uDAAuD,CAAAC,QAAA,eACpEtQ,KAAA,QAAAsQ,QAAA,eACExQ,IAAA,MAAGuQ,SAAS,CAAC,aAAa,CAAAC,QAAA,CAAE3O,cAAc,SAAdA,cAAc,iBAAdA,cAAc,CAAEoC,IAAI,CAAI,CAAC,cACrD/D,KAAA,MAAGqQ,SAAS,CAAC,uBAAuB,CAAAC,QAAA,EAAC,QAAM,CAACrO,YAAY,SAAZA,YAAY,iBAAZA,YAAY,CAAEkG,MAAM,EAAI,CAAC,EAClE,CAAC,cACNnI,KAAA,QAAKqQ,SAAS,CAAC,YAAY,CAAAC,QAAA,eACzBtQ,KAAA,MAAGqQ,SAAS,CAAC,WAAW,CAAAC,QAAA,EAAC,QAAC,CAACtE,cAAc,CAACnI,WAAW,CAACO,QAAQ,CAAC,EAAI,CAAC,cACpEpE,KAAA,MAAGqQ,SAAS,CAAC,uBAAuB,CAAAC,QAAA,EACjCzM,WAAW,CAACO,QAAQ,CAAC,GAAC,CAAC0E,QAAQ,CAACjF,WAAW,CAACO,QAAQ,CAAC,GAAK,CAAC,CAAG,MAAM,CAAG,OAAO,EAC9E,CAAC,EACD,CAAC,EACH,CAAC,EACH,CAAC,cAGNpE,KAAA,QAAKqQ,SAAS,CAAC,MAAM,CAAAC,QAAA,eACnBxQ,IAAA,OAAIuQ,SAAS,CAAC,kBAAkB,CAAAC,QAAA,CAAC,sBAAoB,CAAI,CAAC,cAC1DtQ,KAAA,QAAKqQ,SAAS,CAAC,WAAW,CAAAC,QAAA,eACxBtQ,KAAA,QAAAsQ,QAAA,eACEtQ,KAAA,UAAOqQ,SAAS,CAAC,gCAAgC,CAAAC,QAAA,EAAC,YAAU,cAAAxQ,IAAA,SAAMuQ,SAAS,CAAC,cAAc,CAAAC,QAAA,CAAC,GAAC,CAAM,CAAC,EAAO,CAAC,cAC3GxQ,IAAA,UACEuI,IAAI,CAAC,MAAM,CACXtE,IAAI,CAAC,MAAM,CACXxD,KAAK,CAAEsD,WAAW,CAACE,IAAK,CACxBqO,QAAQ,CAAEvG,iBAAkB,CAC5BwG,WAAW,CAAC,sBAAsB,CAClChC,SAAS,CAAC,8CAA8C,CACxDiC,QAAQ,MACT,CAAC,EACC,CAAC,cAENtS,KAAA,QAAKqQ,SAAS,CAAC,wBAAwB,CAAAC,QAAA,eACrCtQ,KAAA,QAAAsQ,QAAA,eACEtQ,KAAA,UAAOqQ,SAAS,CAAC,gCAAgC,CAAAC,QAAA,EAAC,iBAAe,cAAAxQ,IAAA,SAAMuQ,SAAS,CAAC,cAAc,CAAAC,QAAA,CAAC,GAAC,CAAM,CAAC,EAAO,CAAC,cAChHxQ,IAAA,UACEuI,IAAI,CAAC,MAAM,CACXtE,IAAI,CAAC,eAAe,CACpBxD,KAAK,CAAEsD,WAAW,CAACG,aAAc,CACjCoO,QAAQ,CAAEvG,iBAAkB,CAC5BwG,WAAW,CAAC,iBAAiB,CAC7BhC,SAAS,CAAC,8CAA8C,CACxDiC,QAAQ,MACT,CAAC,EACC,CAAC,cACNtS,KAAA,QAAAsQ,QAAA,eACExQ,IAAA,UAAOuQ,SAAS,CAAC,gCAAgC,CAAAC,QAAA,CAAC,cAAY,CAAO,CAAC,cACtExQ,IAAA,WACEiE,IAAI,CAAC,aAAa,CAClBxD,KAAK,CAAEsD,WAAW,CAACI,WAAY,CAC/BmO,QAAQ,CAAEvG,iBAAkB,CAC5BwE,SAAS,CAAC,8CAA8C,CAAAC,QAAA,CAEvD5P,aAAa,CAACyJ,GAAG,CAAC9B,IAAI,eACrBvI,IAAA,WAAyBS,KAAK,CAAE8H,IAAI,CAAC9H,KAAM,CAAA+P,QAAA,CAAEjI,IAAI,CAAC7H,KAAK,EAA1C6H,IAAI,CAAC9H,KAA8C,CACjE,CAAC,CACI,CAAC,EACN,CAAC,EACH,CAAC,cAENP,KAAA,QAAKqQ,SAAS,CAAC,wBAAwB,CAAAC,QAAA,eACrCtQ,KAAA,QAAAsQ,QAAA,eACEtQ,KAAA,UAAOqQ,SAAS,CAAC,gCAAgC,CAAAC,QAAA,EAAC,gBAAc,cAAAxQ,IAAA,SAAMuQ,SAAS,CAAC,cAAc,CAAAC,QAAA,CAAC,GAAC,CAAM,CAAC,EAAO,CAAC,cAC/GxQ,IAAA,UACEuI,IAAI,CAAC,KAAK,CACVtE,IAAI,CAAC,cAAc,CACnBxD,KAAK,CAAEsD,WAAW,CAACK,YAAa,CAChCkO,QAAQ,CAAEvG,iBAAkB,CAC5BwG,WAAW,CAAC,yBAAyB,CACrChC,SAAS,CAAC,8CAA8C,CACxDkC,SAAS,CAAE,EAAG,CACdD,QAAQ,MACRE,OAAO,CAAC,WAAW,CACpB,CAAC,EACC,CAAC,cACNxS,KAAA,QAAAsQ,QAAA,eACExQ,IAAA,UAAOuQ,SAAS,CAAC,gCAAgC,CAAAC,QAAA,CAAC,UAAQ,CAAO,CAAC,cAClExQ,IAAA,WACEiE,IAAI,CAAC,UAAU,CACfxD,KAAK,CAAEsD,WAAW,CAACO,QAAS,CAC5BgO,QAAQ,CAAEvG,iBAAkB,CAC5BwE,SAAS,CAAC,8CAA8C,CAAAC,QAAA,CAEvDhQ,gBAAgB,CAAC6J,GAAG,CAACsI,MAAM,eAC1BzS,KAAA,WAA2BO,KAAK,CAAEkS,MAAM,CAAClS,KAAM,CAAA+P,QAAA,EAAEmC,MAAM,CAACjS,KAAK,CAAC,WAAI,CAACwL,cAAc,CAACyG,MAAM,CAAClS,KAAK,CAAC,GAAlFkS,MAAM,CAAClS,KAAoF,CACzG,CAAC,CACI,CAAC,EACN,CAAC,EACH,CAAC,EACH,CAAC,EACH,CAAC,cAGNP,KAAA,QAAKqQ,SAAS,CAAC,MAAM,CAAAC,QAAA,eACnBxQ,IAAA,OAAIuQ,SAAS,CAAC,kBAAkB,CAAAC,QAAA,CAAC,gBAAc,CAAI,CAAC,cACpDxQ,IAAA,QAAKuQ,SAAS,CAAC,WAAW,CAAAC,QAAA,CACvB3P,eAAe,CAACwJ,GAAG,CAAC5E,MAAM,eACzBvF,KAAA,UAA0BqQ,SAAS,CAAC,yEAAyE,CAAAC,QAAA,eAC3GxQ,IAAA,UACEuI,IAAI,CAAC,OAAO,CACZtE,IAAI,CAAC,eAAe,CACpBxD,KAAK,CAAEgF,MAAM,CAAChF,KAAM,CACpBmS,OAAO,CAAE7O,WAAW,CAACM,aAAa,GAAKoB,MAAM,CAAChF,KAAM,CACpD6R,QAAQ,CAAEvG,iBAAkB,CAC5BwE,SAAS,CAAC,MAAM,CACjB,CAAC,cACFvQ,IAAA,SAAAwQ,QAAA,CAAO/K,MAAM,CAAC/E,KAAK,CAAO,CAAC,GATjB+E,MAAM,CAAChF,KAUZ,CACR,CAAC,CACC,CAAC,EACH,CAAC,CAGLsD,WAAW,CAACM,aAAa,GAAK,MAAM,eACnCnE,KAAA,QAAKqQ,SAAS,CAAC,oBAAoB,CAAAC,QAAA,eACjCxQ,IAAA,OAAIuQ,SAAS,CAAC,kBAAkB,CAAAC,QAAA,CAAC,kBAAgB,CAAI,CAAC,cACtDtQ,KAAA,QAAKqQ,SAAS,CAAC,WAAW,CAAAC,QAAA,eACxBtQ,KAAA,QAAAsQ,QAAA,eACExQ,IAAA,UAAOuQ,SAAS,CAAC,gCAAgC,CAAAC,QAAA,CAAC,aAAW,CAAO,CAAC,cACrExQ,IAAA,UACEuI,IAAI,CAAC,MAAM,CACXtE,IAAI,CAAC,YAAY,CACjBxD,KAAK,CAAEmE,QAAQ,CAACE,UAAW,CAC3BwN,QAAQ,CAAElC,qBAAsB,CAChCmC,WAAW,CAAC,qBAAqB,CACjChC,SAAS,CAAC,8CAA8C,CACzD,CAAC,EACC,CAAC,cACNrQ,KAAA,QAAKqQ,SAAS,CAAC,wBAAwB,CAAAC,QAAA,eACrCtQ,KAAA,QAAAsQ,QAAA,eACExQ,IAAA,UAAOuQ,SAAS,CAAC,gCAAgC,CAAAC,QAAA,CAAC,aAAW,CAAO,CAAC,cACrExQ,IAAA,UACEuI,IAAI,CAAC,MAAM,CACXtE,IAAI,CAAC,YAAY,CACjBxD,KAAK,CAAEmE,QAAQ,CAACG,UAAW,CAC3BuN,QAAQ,CAAElC,qBAAsB,CAChCmC,WAAW,CAAC,OAAO,CACnBhC,SAAS,CAAC,8CAA8C,CACzD,CAAC,EACC,CAAC,cACNrQ,KAAA,QAAAsQ,QAAA,eACExQ,IAAA,UAAOuQ,SAAS,CAAC,gCAAgC,CAAAC,QAAA,CAAC,KAAG,CAAO,CAAC,cAC7DxQ,IAAA,UACEuI,IAAI,CAAC,MAAM,CACXtE,IAAI,CAAC,KAAK,CACVxD,KAAK,CAAEmE,QAAQ,CAACI,GAAI,CACpBsN,QAAQ,CAAElC,qBAAsB,CAChCmC,WAAW,CAAC,KAAK,CACjBhC,SAAS,CAAC,8CAA8C,CACxDkC,SAAS,CAAE,CAAE,CACd,CAAC,EACC,CAAC,EACH,CAAC,EACH,CAAC,EACH,CACN,CAEA1O,WAAW,CAACM,aAAa,GAAK,KAAK,eAClCnE,KAAA,QAAKqQ,SAAS,CAAC,oBAAoB,CAAAC,QAAA,eACjCxQ,IAAA,OAAIuQ,SAAS,CAAC,kBAAkB,CAAAC,QAAA,CAAC,aAAW,CAAI,CAAC,cACjDxQ,IAAA,MAAGuQ,SAAS,CAAC,4BAA4B,CAAAC,QAAA,CAAC,sEAAoE,CAAG,CAAC,cAClHtQ,KAAA,QAAKqQ,SAAS,CAAC,iDAAiD,CAAAC,QAAA,eAC9DxQ,IAAA,QAAKiR,GAAG,CAAC,4BAA4B,CAACC,GAAG,CAAC,YAAY,CAACX,SAAS,CAAC,KAAK,CAAE,CAAC,cACzEvQ,IAAA,QAAKiR,GAAG,CAAC,+BAA+B,CAACC,GAAG,CAAC,SAAS,CAACX,SAAS,CAAC,KAAK,CAAE,CAAC,cACzEvQ,IAAA,QAAKiR,GAAG,CAAC,6BAA6B,CAACC,GAAG,CAAC,OAAO,CAACX,SAAS,CAAC,KAAK,CAAE,CAAC,cACrEvQ,IAAA,QAAKiR,GAAG,CAAC,4BAA4B,CAACC,GAAG,CAAC,MAAM,CAACX,SAAS,CAAC,KAAK,CAAE,CAAC,EAChE,CAAC,EACH,CACN,cAEDrQ,KAAA,QAAKqQ,SAAS,CAAC,uBAAuB,CAAAC,QAAA,eACpCxQ,IAAA,CAACf,MAAM,EACLyR,OAAO,CAAC,SAAS,CACjBE,OAAO,CAAEA,CAAA,GAAM,CACbtO,qBAAqB,CAAC,KAAK,CAAC,CAC5BY,eAAe,CAAC,KAAK,CAAC,CACxB,CAAE,CACFqN,SAAS,CAAC,MAAM,CAAAC,QAAA,CACjB,QAED,CAAQ,CAAC,cACTxQ,IAAA,CAACf,MAAM,EACLyR,OAAO,CAAC,SAAS,CACjBE,OAAO,CAAExB,aAAc,CACvBmB,SAAS,CAAC,8CAA8C,CAAAC,QAAA,CACzD,iBAED,CAAQ,CAAC,EACN,CAAC,EACN,CACH,CACE,CACN,CACI,CAAC,cAGRxQ,IAAA,CAACN,UAAU,EACT8R,MAAM,CAAEjP,gBAAiB,CACzBkP,OAAO,CAAEA,CAAA,GAAM,CACbjP,mBAAmB,CAAC,KAAK,CAAC,CAC1BU,eAAe,CAAC,KAAK,CAAC,CAEtB;AACA,GAAIzB,eAAe,CAAC,CAAC,EAAIU,YAAY,CAAE,CACrCG,qBAAqB,CAAC,IAAI,CAAC,CAC7B,CACF,CAAE,CACFuQ,aAAa,CAAExC,iBAAkB,CAClC,CAAC,cAGFrQ,IAAA,CAACL,WAAW,EACV6R,MAAM,CAAE/O,iBAAkB,CAC1BgP,OAAO,CAAEA,CAAA,GAAM,CACb/O,oBAAoB,CAAC,KAAK,CAAC,CAC3BQ,eAAe,CAAC,KAAK,CAAC,CACxB,CAAE,CACF4P,YAAY,CAAEA,CAAA,GAAM,CAClBpQ,oBAAoB,CAAC,KAAK,CAAC,CAC3BF,mBAAmB,CAAC,IAAI,CAAC,CAC3B,CAAE,CACH,CAAC,cAGFtC,KAAA,QAAKqQ,SAAS,CAAC,oCAAoC,CAAAC,QAAA,eACjDxQ,IAAA,QAAKuQ,SAAS,CAAC,kCAAkC,CAAM,CAAC,cACxDvQ,IAAA,QAAKuQ,SAAS,CAAC,oCAAoC,CAAM,CAAC,cAC1DvQ,IAAA,QAAKuQ,SAAS,CAAC,kCAAkC,CAAM,CAAC,EACrD,CAAC,EACH,CAAC,CAEV,CAAC,CAED,cAAe,CAAAtP,eAAe","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}